<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmbroidTech - Professional Embroidery Solutions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .upload-area {
            border: 2px dashed #e5e7eb;
            transition: all 0.3s ease;
        }
        
        .upload-area.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        
        .filter-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .image-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .image-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .search-highlight {
            background-color: #fef3c7;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .modal {
            backdrop-filter: blur(5px);
        }
        
        .cart-badge {
            animation: bounce 0.5s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .notification {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .payment-method-card input[type="radio"]:checked + div {
            color: #3b82f6;
        }
        
        .payment-method-card:has(input[type="radio"]:checked) {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        
        .payment-form {
            transition: all 0.3s ease;
        }
        
        .wallet-btn:hover, .upi-quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .wallet-btn.selected, .upi-quick-btn.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        
        .payment-processing {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2L2 7v10c0 5.55 3.84 9.74 9 11 5.16-1.26 9-5.45 9-11V7l-10-5z"/>
                    </svg>
                    <h1 class="text-2xl font-bold">EmbroidTech</h1>
                </div>
                <nav class="hidden md:flex items-center space-x-6">
                    <a href="#gallery" class="hover:text-blue-200 transition-colors">Gallery</a>
                    <a href="#upload" class="hover:text-blue-200 transition-colors">Upload</a>
                    <a href="#services" class="hover:text-blue-200 transition-colors">Services</a>
                    <button id="adminBtn" class="hover:text-blue-200 transition-colors">Admin Panel</button>
                    <button id="loginBtn" class="hover:text-blue-200 transition-colors">Login</button>
                    <button id="cartBtn" class="relative bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all">
                        <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20C20.55 4 21 4.45 21 5S20.55 6 20 6H19V19C19 20.1 18.1 21 17 21H7C5.9 21 5 20.1 5 19V6H4C3.45 6 3 5.55 3 5S3.45 4 4 4H7ZM9 3V4H15V3H9ZM7 6V19H17V6H7Z"/>
                        </svg>
                        Cart
                        <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center cart-badge hidden">0</span>
                    </button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <!-- Hero Section -->
        <section class="text-center mb-12">
            <h2 class="text-4xl font-bold text-gray-800 mb-4">Professional Embroidery Solutions</h2>
            <p class="text-xl text-gray-600 mb-8">Transform your designs into beautiful embroidered masterpieces</p>
            
            <!-- Smart Search -->
            <div class="relative max-w-2xl mx-auto">
                <input 
                    type="text" 
                    id="globalSearch" 
                    placeholder="Try: 'I need mirror work on my anarkali size 36,34,36' or 'floral design for girl tshirt'"
                    class="w-full px-6 py-4 text-lg border-2 border-gray-200 rounded-full focus:border-blue-500 focus:outline-none shadow-lg"
                >
                <svg class="absolute right-6 top-1/2 transform -translate-y-1/2 w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <div id="smartSearchResults" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg mt-2 hidden z-10">
                    <!-- Smart search results will appear here -->
                </div>
            </div>
        </section>

        <!-- Upload & Design Section -->
        <section id="upload" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Create & Upload Your Designs</h2>
            <div class="max-w-6xl mx-auto">
                <!-- Design Options -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <button id="uploadBtn" class="design-option-btn bg-blue-500 hover:bg-blue-600 text-white p-6 rounded-xl transition-all transform hover:scale-105">
                        <svg class="mx-auto w-12 h-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                        <h3 class="text-lg font-semibold mb-2">Upload Design</h3>
                        <p class="text-blue-100 text-sm">Upload your existing designs</p>
                    </button>
                    
                    <button id="drawBtn" class="design-option-btn bg-purple-500 hover:bg-purple-600 text-white p-6 rounded-xl transition-all transform hover:scale-105">
                        <svg class="mx-auto w-12 h-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold mb-2">Draw Design</h3>
                        <p class="text-purple-100 text-sm">Create with drawing tools</p>
                    </button>
                    
                    <button id="aiGenerateBtn" class="design-option-btn bg-green-500 hover:bg-green-600 text-white p-6 rounded-xl transition-all transform hover:scale-105">
                        <svg class="mx-auto w-12 h-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold mb-2">AI Generate</h3>
                        <p class="text-green-100 text-sm">Generate with AI prompts</p>
                    </button>
                </div>

                <!-- Upload Area -->
                <div id="uploadArea" class="upload-area p-12 rounded-xl text-center cursor-pointer hidden">
                    <svg class="mx-auto w-16 h-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                    </svg>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Drop images here or click to browse</h3>
                    <p class="text-gray-500">Supports JPG, PNG, GIF up to 10MB</p>
                    <input type="file" id="fileInput" multiple accept="image/*" class="hidden">
                </div>
                
                <div id="uploadProgress" class="mt-6 hidden">
                    <div class="bg-gray-200 rounded-full h-3">
                        <div id="progressBar" class="gradient-bg h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p id="progressText" class="text-center mt-2 text-gray-600">Uploading...</p>
                </div>
            </div>
        </section>

        <!-- Filter Section -->
        <section class="mb-8">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Browse Categories</h3>
            <div class="flex flex-wrap gap-3">
                <button class="filter-btn active px-6 py-3 rounded-full border-2 border-gray-300 hover:border-blue-500 transition-all" data-filter="all">
                    All Designs
                </button>
                <button class="filter-btn px-6 py-3 rounded-full border-2 border-gray-300 hover:border-blue-500 transition-all" data-filter="floral">
                    Floral
                </button>
                <button class="filter-btn px-6 py-3 rounded-full border-2 border-gray-300 hover:border-blue-500 transition-all" data-filter="corporate">
                    Corporate
                </button>
                <button class="filter-btn px-6 py-3 rounded-full border-2 border-gray-300 hover:border-blue-500 transition-all" data-filter="sports">
                    Sports
                </button>
                <button class="filter-btn px-6 py-3 rounded-full border-2 border-gray-300 hover:border-blue-500 transition-all" data-filter="custom">
                    Custom
                </button>
            </div>
        </section>

        <!-- Design Gallery -->
        <section id="gallery">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Design Gallery</h3>
                <div class="flex items-center space-x-4">
                    <span class="text-gray-600">View:</span>
                    <button id="gridView" class="p-2 rounded bg-blue-500 text-white">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M3 3h7v7H3V3zm0 11h7v7H3v-7zm11-11h7v7h-7V3zm0 11h7v7h-7v-7z"/>
                        </svg>
                    </button>
                    <button id="listView" class="p-2 rounded bg-gray-300 text-gray-600">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div id="imageGallery" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Design cards will be populated by JavaScript -->
            </div>

            <div id="noResults" class="text-center py-12 hidden">
                <svg class="mx-auto w-16 h-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.674-2.326M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                </svg>
                <h3 class="text-xl font-semibold text-gray-600 mb-2">No designs found</h3>
                <p class="text-gray-500">Try adjusting your search or filter criteria</p>
            </div>
        </section>
    </main>

    <!-- Live Chat Widget -->
    <div id="chatWidget" class="fixed bottom-6 right-6 z-50">
        <div id="chatButton" class="bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-full shadow-lg cursor-pointer transition-all duration-300 transform hover:scale-110">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
            </svg>
        </div>
        
        <div id="chatWindow" class="hidden absolute bottom-16 right-0 w-80 h-96 bg-white rounded-lg shadow-2xl border overflow-hidden">
            <div class="gradient-bg text-white p-4 flex justify-between items-center">
                <div>
                    <h4 class="font-semibold">Live Support</h4>
                    <p class="text-sm text-blue-100">We're online now!</p>
                </div>
                <button id="closeChatBtn" class="text-white hover:text-gray-200">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            
            <div id="chatMessages" class="h-64 overflow-y-auto p-4 space-y-3">
                <div class="flex items-start space-x-2">
                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-semibold">AI</div>
                    <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                        <p class="text-sm">Hello! Welcome to EmbroidTech. How can I help you today?</p>
                    </div>
                </div>
            </div>
            
            <div class="p-4 border-t">
                <div class="flex space-x-2">
                    <input type="text" id="chatInput" placeholder="Type your message..." class="flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    <button id="sendChatBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold text-gray-800"></h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <div id="modalImage" class="w-full h-64 bg-gray-200 rounded-lg flex items-center justify-center overflow-hidden">
                        <!-- Image will be inserted here -->
                    </div>
                </div>
                <div>
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold text-gray-700">Description</h4>
                            <p id="modalDescription" class="text-gray-600"></p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-700">Category</h4>
                            <span id="modalCategory" class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm"></span>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-700">Price Range</h4>
                            <p id="modalPrice" class="text-2xl font-bold text-green-600"></p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-700">Estimated Time</h4>
                            <p id="modalTime" class="text-gray-600"></p>
                        </div>
                        <div class="flex space-x-3">
                            <button id="addToCartBtn" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                Add to Cart
                            </button>
                            <button id="addToWishlistBtn" class="px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Shopping Cart</h3>
                <button id="closeCartBtn" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div id="cartItems" class="space-y-4 mb-6">
                <!-- Cart items will be populated here -->
            </div>
            <div class="border-t pt-4">
                <div class="flex justify-between items-center text-xl font-bold mb-4">
                    <span>Total:</span>
                    <span id="cartTotal">$0.00</span>
                </div>
                <button id="checkoutBtn" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors font-medium">
                    Proceed to Checkout
                </button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <div class="text-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-2">Welcome Back</h3>
                <p class="text-gray-600">Sign in to your account</p>
            </div>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="loginEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="loginPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                    Sign In
                </button>
            </form>
            <div class="mt-6 text-center">
                <p class="text-gray-600">Don't have an account? <button id="showRegisterBtn" class="text-blue-600 hover:text-blue-700 font-medium">Sign up</button></p>
            </div>
            <button id="closeLoginBtn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Secure Checkout</h3>
                <button id="closeCheckoutBtn" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <form id="checkoutForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                        <input type="text" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                        <input type="text" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                    <input type="tel" id="checkoutPhone" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                    <textarea required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="3"></textarea>
                </div>
                <div class="border-t pt-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Payment Method</h4>
                    <div class="space-y-4">
                        <!-- Credit/Debit Card -->
                        <label class="payment-method-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-blue-500 transition-all">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <input type="radio" name="payment" value="card" checked class="mr-3">
                                    <div>
                                        <span class="font-medium">Credit/Debit Card</span>
                                        <div class="flex space-x-2 mt-1">
                                            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAzMiAyMCIgZmlsbD0ibm9uZSI+PHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjIwIiByeD0iNCIgZmlsbD0iIzAwNTFBNSIvPjx0ZXh0IHg9IjE2IiB5PSIxNCIgZm9udC1zaXplPSI4IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+VklTQTwvdGV4dD48L3N2Zz4=" alt="Visa" class="w-8 h-5">
                                            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAzMiAyMCIgZmlsbD0ibm9uZSI+PHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjIwIiByeD0iNCIgZmlsbD0iI0VCMDAxQiIvPjx0ZXh0IHg9IjE2IiB5PSIxNCIgZm9udC1zaXplPSI2IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+TWFzdGVyQ2FyZDwvdGV4dD48L3N2Zz4=" alt="MasterCard" class="w-8 h-5">
                                        </div>
                                    </div>
                                </div>
                                <span class="text-green-600 font-medium">Most Secure</span>
                            </div>
                        </label>

                        <!-- UPI Payment -->
                        <label class="payment-method-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-blue-500 transition-all">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <input type="radio" name="payment" value="upi" class="mr-3">
                                    <div>
                                        <span class="font-medium">UPI Payment</span>
                                        <div class="flex space-x-2 mt-1">
                                            <span class="text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded">GPay</span>
                                            <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">PhonePe</span>
                                            <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded">Paytm</span>
                                        </div>
                                    </div>
                                </div>
                                <span class="text-blue-600 font-medium">Instant</span>
                            </div>
                        </label>

                        <!-- Net Banking -->
                        <label class="payment-method-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-blue-500 transition-all">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <input type="radio" name="payment" value="netbanking" class="mr-3">
                                    <div>
                                        <span class="font-medium">Net Banking</span>
                                        <p class="text-xs text-gray-500 mt-1">All major banks supported</p>
                                    </div>
                                </div>
                                <span class="text-gray-600 font-medium">Secure</span>
                            </div>
                        </label>

                        <!-- Digital Wallets -->
                        <label class="payment-method-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-blue-500 transition-all">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <input type="radio" name="payment" value="wallet" class="mr-3">
                                    <div>
                                        <span class="font-medium">Digital Wallets</span>
                                        <div class="flex space-x-2 mt-1">
                                            <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">PayPal</span>
                                            <span class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded">Razorpay</span>
                                        </div>
                                    </div>
                                </div>
                                <span class="text-purple-600 font-medium">Quick</span>
                            </div>
                        </label>

                        <!-- Buy Now Pay Later -->
                        <label class="payment-method-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-blue-500 transition-all">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <input type="radio" name="payment" value="bnpl" class="mr-3">
                                    <div>
                                        <span class="font-medium">Buy Now Pay Later</span>
                                        <p class="text-xs text-gray-500 mt-1">0% interest for 3 months</p>
                                    </div>
                                </div>
                                <span class="text-orange-600 font-medium">0% EMI</span>
                            </div>
                        </label>
                    </div>

                    <!-- Payment Details Form -->
                    <div id="paymentDetailsForm" class="mt-6 space-y-4">
                        <!-- Card Payment Form -->
                        <div id="cardPaymentForm" class="payment-form">
                            <h5 class="font-semibold text-gray-700 mb-3">Card Details</h5>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Card Number</label>
                                    <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Expiry Date</label>
                                        <input type="text" id="expiryDate" placeholder="MM/YY" maxlength="5" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">CVV</label>
                                        <input type="text" id="cvv" placeholder="123" maxlength="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Cardholder Name</label>
                                    <input type="text" id="cardholderName" placeholder="John Doe" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                            </div>
                        </div>

                        <!-- UPI Payment Form -->
                        <div id="upiPaymentForm" class="payment-form hidden">
                            <h5 class="font-semibold text-gray-700 mb-3">UPI Payment</h5>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">UPI ID</label>
                                    <input type="text" id="upiId" placeholder="yourname@paytm" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div class="bg-blue-50 p-3 rounded-lg">
                                    <p class="text-sm text-blue-800">
                                        <strong>Quick Pay Options:</strong>
                                    </p>
                                    <div class="grid grid-cols-3 gap-2 mt-2">
                                        <button type="button" class="upi-quick-btn bg-white border border-blue-200 rounded-lg p-2 hover:bg-blue-50" data-app="gpay">
                                            <div class="text-center">
                                                <div class="w-8 h-8 bg-green-500 rounded-full mx-auto mb-1 flex items-center justify-center text-white text-xs font-bold">G</div>
                                                <span class="text-xs">Google Pay</span>
                                            </div>
                                        </button>
                                        <button type="button" class="upi-quick-btn bg-white border border-blue-200 rounded-lg p-2 hover:bg-blue-50" data-app="phonepe">
                                            <div class="text-center">
                                                <div class="w-8 h-8 bg-purple-600 rounded-full mx-auto mb-1 flex items-center justify-center text-white text-xs font-bold">P</div>
                                                <span class="text-xs">PhonePe</span>
                                            </div>
                                        </button>
                                        <button type="button" class="upi-quick-btn bg-white border border-blue-200 rounded-lg p-2 hover:bg-blue-50" data-app="paytm">
                                            <div class="text-center">
                                                <div class="w-8 h-8 bg-blue-600 rounded-full mx-auto mb-1 flex items-center justify-center text-white text-xs font-bold">P</div>
                                                <span class="text-xs">Paytm</span>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Net Banking Form -->
                        <div id="netbankingPaymentForm" class="payment-form hidden">
                            <h5 class="font-semibold text-gray-700 mb-3">Select Your Bank</h5>
                            <div class="grid grid-cols-2 gap-3">
                                <select id="bankSelect" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Choose your bank</option>
                                    <option value="sbi">State Bank of India</option>
                                    <option value="hdfc">HDFC Bank</option>
                                    <option value="icici">ICICI Bank</option>
                                    <option value="axis">Axis Bank</option>
                                    <option value="kotak">Kotak Mahindra Bank</option>
                                    <option value="pnb">Punjab National Bank</option>
                                    <option value="bob">Bank of Baroda</option>
                                    <option value="canara">Canara Bank</option>
                                </select>
                            </div>
                        </div>

                        <!-- Wallet Payment Form -->
                        <div id="walletPaymentForm" class="payment-form hidden">
                            <h5 class="font-semibold text-gray-700 mb-3">Choose Wallet</h5>
                            <div class="grid grid-cols-2 gap-3">
                                <button type="button" class="wallet-btn border-2 border-gray-200 rounded-lg p-4 hover:border-blue-500 transition-all" data-wallet="paypal">
                                    <div class="text-center">
                                        <div class="w-12 h-12 bg-blue-600 rounded-lg mx-auto mb-2 flex items-center justify-center text-white font-bold">PP</div>
                                        <span class="font-medium">PayPal</span>
                                    </div>
                                </button>
                                <button type="button" class="wallet-btn border-2 border-gray-200 rounded-lg p-4 hover:border-blue-500 transition-all" data-wallet="razorpay">
                                    <div class="text-center">
                                        <div class="w-12 h-12 bg-indigo-600 rounded-lg mx-auto mb-2 flex items-center justify-center text-white font-bold">RP</div>
                                        <span class="font-medium">Razorpay</span>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- BNPL Form -->
                        <div id="bnplPaymentForm" class="payment-form hidden">
                            <h5 class="font-semibold text-gray-700 mb-3">Buy Now Pay Later</h5>
                            <div class="bg-orange-50 p-4 rounded-lg">
                                <h6 class="font-semibold text-orange-800 mb-2">EMI Options</h6>
                                <div class="space-y-2">
                                    <label class="flex items-center justify-between p-2 bg-white rounded border cursor-pointer hover:bg-orange-50">
                                        <div class="flex items-center">
                                            <input type="radio" name="emi" value="3" class="mr-3">
                                            <span>3 months EMI</span>
                                        </div>
                                        <span class="font-semibold text-green-600" id="emi3Amount">$0/month</span>
                                    </label>
                                    <label class="flex items-center justify-between p-2 bg-white rounded border cursor-pointer hover:bg-orange-50">
                                        <div class="flex items-center">
                                            <input type="radio" name="emi" value="6" class="mr-3">
                                            <span>6 months EMI</span>
                                        </div>
                                        <span class="font-semibold text-green-600" id="emi6Amount">$0/month</span>
                                    </label>
                                    <label class="flex items-center justify-between p-2 bg-white rounded border cursor-pointer hover:bg-orange-50">
                                        <div class="flex items-center">
                                            <input type="radio" name="emi" value="12" class="mr-3">
                                            <span>12 months EMI</span>
                                        </div>
                                        <span class="font-semibold text-green-600" id="emi12Amount">$0/month</span>
                                    </label>
                                </div>
                                <p class="text-xs text-orange-700 mt-3">
                                    <strong>Note:</strong> 0% interest for first 3 months. Standard rates apply thereafter.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-between items-center text-xl font-bold">
                    <span>Total Amount:</span>
                    <span id="checkoutTotal">$0.00</span>
                </div>
                <button type="submit" class="w-full bg-green-600 text-white py-4 rounded-lg hover:bg-green-700 transition-colors font-medium text-lg">
                    🔒 Pay Securely
                </button>
            </form>
        </div>
    </div>

    <!-- Design Editor Modal -->
    <div id="designEditorModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white rounded-lg w-full h-full max-w-7xl max-h-screen m-4 flex flex-col">
            <div class="flex justify-between items-center p-6 border-b">
                <h3 class="text-2xl font-bold text-gray-800">Design Editor</h3>
                <button id="closeEditorBtn" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            
            <div class="flex flex-1 overflow-hidden">
                <!-- Tools Panel -->
                <div class="w-64 bg-gray-50 p-4 border-r overflow-y-auto">
                    <div class="space-y-6">
                        <!-- Drawing Tools -->
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-3">Drawing Tools</h4>
                            <div class="grid grid-cols-2 gap-2">
                                <button id="brushTool" class="tool-btn active p-3 border rounded-lg hover:bg-blue-50 transition-colors">
                                    <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                                    </svg>
                                    <span class="text-xs">Brush</span>
                                </button>
                                <button id="eraserTool" class="tool-btn p-3 border rounded-lg hover:bg-blue-50 transition-colors">
                                    <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                    <span class="text-xs">Eraser</span>
                                </button>
                                <button id="lineTool" class="tool-btn p-3 border rounded-lg hover:bg-blue-50 transition-colors">
                                    <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                    <span class="text-xs">Line</span>
                                </button>
                                <button id="shapeTool" class="tool-btn p-3 border rounded-lg hover:bg-blue-50 transition-colors">
                                    <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span class="text-xs">Shape</span>
                                </button>
                            </div>
                        </div>

                        <!-- Brush Settings -->
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-3">Brush Settings</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Size</label>
                                    <input type="range" id="brushSize" min="1" max="50" value="5" class="w-full">
                                    <span id="brushSizeValue" class="text-xs text-gray-500">5px</span>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Color</label>
                                    <input type="color" id="brushColor" value="#000000" class="w-full h-10 rounded border">
                                </div>
                            </div>
                        </div>

                        <!-- Garment Preview -->
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-3">Preview On</h4>
                            <div class="grid grid-cols-2 gap-2">
                                <button class="garment-btn active p-2 border rounded-lg hover:bg-blue-50 transition-colors" data-garment="tshirt">
                                    <div class="text-2xl mb-1">👕</div>
                                    <span class="text-xs">T-Shirt</span>
                                </button>
                                <button class="garment-btn p-2 border rounded-lg hover:bg-blue-50 transition-colors" data-garment="hoodie">
                                    <div class="text-2xl mb-1">🧥</div>
                                    <span class="text-xs">Hoodie</span>
                                </button>
                                <button class="garment-btn p-2 border rounded-lg hover:bg-blue-50 transition-colors" data-garment="cap">
                                    <div class="text-2xl mb-1">🧢</div>
                                    <span class="text-xs">Cap</span>
                                </button>
                                <button class="garment-btn p-2 border rounded-lg hover:bg-blue-50 transition-colors" data-garment="bag">
                                    <div class="text-2xl mb-1">🎒</div>
                                    <span class="text-xs">Bag</span>
                                </button>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="space-y-2">
                            <button id="clearCanvas" class="w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600 transition-colors">
                                Clear Canvas
                            </button>
                            <button id="saveDesign" class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 transition-colors">
                                Save Design
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Canvas Area -->
                <div class="flex-1 flex">
                    <!-- Drawing Canvas -->
                    <div class="flex-1 p-6 bg-gray-100">
                        <div class="bg-white rounded-lg shadow-lg p-4 h-full">
                            <canvas id="drawingCanvas" class="border border-gray-300 rounded cursor-crosshair" width="600" height="400"></canvas>
                        </div>
                    </div>

                    <!-- Garment Preview -->
                    <div class="w-80 p-6 bg-gray-50 border-l">
                        <h4 class="font-semibold text-gray-700 mb-4">Live Preview</h4>
                        <div id="garmentPreview" class="bg-white rounded-lg shadow-lg p-6 text-center">
                            <div id="garmentDisplay" class="relative inline-block">
                                <!-- Garment SVG will be inserted here -->
                            </div>
                        </div>
                        
                        <!-- Size & Position Controls -->
                        <div class="mt-4 space-y-3">
                            <div>
                                <label class="block text-sm text-gray-600 mb-1">Design Size</label>
                                <input type="range" id="designSize" min="50" max="200" value="100" class="w-full">
                                <span id="designSizeValue" class="text-xs text-gray-500">100%</span>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-1">Position X</label>
                                <input type="range" id="designX" min="-50" max="50" value="0" class="w-full">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-1">Position Y</label>
                                <input type="range" id="designY" min="-50" max="50" value="0" class="w-full">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Design Generator Modal -->
    <div id="aiGeneratorModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">AI Design Generator</h3>
                <button id="closeAiGeneratorBtn" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Describe your design</label>
                    <textarea id="aiPrompt" placeholder="e.g., 'Create a floral design with roses and butterflies for a girl's t-shirt'" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="3"></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Style</label>
                        <select id="aiStyle" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="modern">Modern</option>
                            <option value="vintage">Vintage</option>
                            <option value="minimalist">Minimalist</option>
                            <option value="artistic">Artistic</option>
                            <option value="cute">Cute</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Colors</label>
                        <select id="aiColors" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="colorful">Colorful</option>
                            <option value="pastel">Pastel</option>
                            <option value="monochrome">Monochrome</option>
                            <option value="bright">Bright</option>
                            <option value="earth">Earth Tones</option>
                        </select>
                    </div>
                </div>
                
                <button id="generateDesignBtn" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors font-medium">
                    🎨 Generate Design
                </button>
                
                <div id="aiGeneratedResults" class="hidden">
                    <h4 class="font-semibold text-gray-700 mb-3">Generated Designs</h4>
                    <div id="aiDesignGrid" class="grid grid-cols-2 gap-4">
                        <!-- Generated designs will appear here -->
                    </div>
                    
                    <!-- Design Customization Panel -->
                    <div id="designCustomization" class="mt-6 p-4 bg-gray-50 rounded-lg hidden">
                        <h5 class="font-semibold text-gray-700 mb-3">Customize Your Design</h5>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Change Colors</label>
                                <div class="flex space-x-2">
                                    <button class="color-option w-8 h-8 rounded-full bg-red-500 border-2 border-gray-300 hover:border-gray-500" data-color="red"></button>
                                    <button class="color-option w-8 h-8 rounded-full bg-blue-500 border-2 border-gray-300 hover:border-gray-500" data-color="blue"></button>
                                    <button class="color-option w-8 h-8 rounded-full bg-green-500 border-2 border-gray-300 hover:border-gray-500" data-color="green"></button>
                                    <button class="color-option w-8 h-8 rounded-full bg-purple-500 border-2 border-gray-300 hover:border-gray-500" data-color="purple"></button>
                                    <button class="color-option w-8 h-8 rounded-full bg-yellow-500 border-2 border-gray-300 hover:border-gray-500" data-color="yellow"></button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Size</label>
                                <select id="designSizeSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                    <option value="small">Small (2-3 inches)</option>
                                    <option value="medium" selected>Medium (4-5 inches)</option>
                                    <option value="large">Large (6-7 inches)</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Background Style</label>
                            <div class="grid grid-cols-3 gap-2">
                                <button class="bg-style-btn p-2 border rounded-lg hover:bg-blue-50 text-sm" data-style="solid">Solid</button>
                                <button class="bg-style-btn p-2 border rounded-lg hover:bg-blue-50 text-sm" data-style="gradient">Gradient</button>
                                <button class="bg-style-btn p-2 border rounded-lg hover:bg-blue-50 text-sm" data-style="pattern">Pattern</button>
                            </div>
                        </div>
                        <button id="applyCustomization" class="w-full mt-4 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                            Apply Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- OTP Verification Modal -->
    <div id="otpModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">Verify Your Phone</h3>
                <p class="text-gray-600">Enter the 6-digit code sent to <span id="otpPhone" class="font-medium"></span></p>
            </div>
            <div class="flex justify-center space-x-2 mb-6">
                <input type="text" maxlength="1" class="w-12 h-12 text-center text-xl font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none otp-input">
                <input type="text" maxlength="1" class="w-12 h-12 text-center text-xl font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none otp-input">
                <input type="text" maxlength="1" class="w-12 h-12 text-center text-xl font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none otp-input">
                <input type="text" maxlength="1" class="w-12 h-12 text-center text-xl font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none otp-input">
                <input type="text" maxlength="1" class="w-12 h-12 text-center text-xl font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none otp-input">
                <input type="text" maxlength="1" class="w-12 h-12 text-center text-xl font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none otp-input">
            </div>
            <button id="verifyOtpBtn" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium mb-4">
                Verify & Complete Payment
            </button>
            <div class="text-center">
                <p class="text-gray-600">Didn't receive code? <button id="resendOtpBtn" class="text-blue-600 hover:text-blue-700 font-medium">Resend</button></p>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white rounded-lg w-full h-full max-w-6xl max-h-screen m-4 flex flex-col">
            <div class="flex justify-between items-center p-6 border-b">
                <h3 class="text-2xl font-bold text-gray-800">Admin Panel - Design Management</h3>
                <button id="closeAdminBtn" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            
            <div class="flex flex-1 overflow-hidden">
                <!-- Admin Sidebar -->
                <div class="w-64 bg-gray-50 p-4 border-r overflow-y-auto">
                    <div class="space-y-4">
                        <button id="addDesignTab" class="admin-tab-btn active w-full text-left p-3 rounded-lg bg-blue-500 text-white">
                            📁 Add New Design
                        </button>
                        <button id="manageDesignsTab" class="admin-tab-btn w-full text-left p-3 rounded-lg hover:bg-gray-200">
                            📋 Manage Designs
                        </button>
                        <button id="keywordsTab" class="admin-tab-btn w-full text-left p-3 rounded-lg hover:bg-gray-200">
                            🔍 Search Keywords
                        </button>
                        <button id="analyticsTab" class="admin-tab-btn w-full text-left p-3 rounded-lg hover:bg-gray-200">
                            📊 Analytics
                        </button>
                    </div>
                </div>

                <!-- Admin Content -->
                <div class="flex-1 p-6 overflow-y-auto">
                    <!-- Add Design Tab -->
                    <div id="addDesignContent" class="admin-content">
                        <h4 class="text-xl font-semibold mb-4">Add New Design</h4>
                        <form id="adminAddDesignForm" class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Design Name</label>
                                    <input type="text" id="adminDesignName" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                                    <select id="adminDesignCategory" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="floral">Floral</option>
                                        <option value="corporate">Corporate</option>
                                        <option value="sports">Sports</option>
                                        <option value="traditional">Traditional</option>
                                        <option value="mirror-work">Mirror Work</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                <textarea id="adminDesignDescription" rows="3" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                            
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Price Range</label>
                                    <input type="text" id="adminDesignPrice" placeholder="$25-45" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Time Required</label>
                                    <input type="text" id="adminDesignTime" placeholder="25-35 minutes" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Garment Types</label>
                                    <select id="adminGarmentTypes" multiple class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="anarkali">Anarkali</option>
                                        <option value="tshirt">T-Shirt</option>
                                        <option value="saree">Saree</option>
                                        <option value="lehenga">Lehenga</option>
                                        <option value="kurta">Kurta</option>
                                        <option value="dupatta">Dupatta</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Search Keywords (comma separated)</label>
                                <input type="text" id="adminSearchKeywords" placeholder="mirror work, traditional, ethnic, wedding" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Upload Design Image</label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                    <input type="file" id="adminDesignImage" accept="image/*" class="hidden">
                                    <button type="button" onclick="document.getElementById('adminDesignImage').click()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                                        Choose Image
                                    </button>
                                    <p class="text-gray-500 mt-2">Or drag and drop an image here</p>
                                    <div id="adminImagePreview" class="mt-4 hidden">
                                        <img id="adminPreviewImg" class="max-w-xs mx-auto rounded-lg shadow-lg">
                                    </div>
                                </div>
                            </div>
                            
                            <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 font-medium">
                                Add Design to Gallery
                            </button>
                        </form>
                    </div>

                    <!-- Manage Designs Tab -->
                    <div id="manageDesignsContent" class="admin-content hidden">
                        <h4 class="text-xl font-semibold mb-4">Manage Existing Designs</h4>
                        <div id="adminDesignsList" class="space-y-4">
                            <!-- Admin designs list will be populated here -->
                        </div>
                    </div>

                    <!-- Keywords Tab -->
                    <div id="keywordsContent" class="admin-content hidden">
                        <h4 class="text-xl font-semibold mb-4">Search Keywords Management</h4>
                        <div class="bg-blue-50 p-4 rounded-lg mb-6">
                            <h5 class="font-semibold text-blue-800 mb-2">How Smart Search Works:</h5>
                            <p class="text-blue-700 text-sm">When customers type queries like "I need mirror work on my anarkali size 36,34,36", the system:</p>
                            <ul class="list-disc list-inside text-blue-700 text-sm mt-2 space-y-1">
                                <li>Extracts keywords: "mirror work", "anarkali", "36,34,36"</li>
                                <li>Finds matching designs with those keywords</li>
                                <li>Creates body visualization with the specified measurements</li>
                                <li>Shows how the design will look on that body type</li>
                            </ul>
                        </div>
                        <div id="keywordsList" class="space-y-3">
                            <!-- Keywords will be listed here -->
                        </div>
                    </div>

                    <!-- Analytics Tab -->
                    <div id="analyticsContent" class="admin-content hidden">
                        <h4 class="text-xl font-semibold mb-4">Search Analytics</h4>
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h5 class="font-semibold text-blue-800">Total Searches</h5>
                                <p class="text-2xl font-bold text-blue-600">1,247</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h5 class="font-semibold text-green-800">Smart Matches</h5>
                                <p class="text-2xl font-bold text-green-600">892</p>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h5 class="font-semibold text-purple-800">Body Visualizations</h5>
                                <p class="text-2xl font-bold text-purple-600">456</p>
                            </div>
                        </div>
                        <div id="searchAnalytics" class="bg-white border rounded-lg p-4">
                            <h5 class="font-semibold mb-3">Recent Search Queries</h5>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between p-2 bg-gray-50 rounded">
                                    <span>"mirror work anarkali size 36,34,36"</span>
                                    <span class="text-green-600">✓ Matched</span>
                                </div>
                                <div class="flex justify-between p-2 bg-gray-50 rounded">
                                    <span>"floral design for girl tshirt"</span>
                                    <span class="text-green-600">✓ Matched</span>
                                </div>
                                <div class="flex justify-between p-2 bg-gray-50 rounded">
                                    <span>"traditional embroidery for saree"</span>
                                    <span class="text-green-600">✓ Matched</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Body Visualization Modal -->
    <div id="bodyVisualizationModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white rounded-lg max-w-4xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center p-6 border-b">
                <h3 class="text-2xl font-bold text-gray-800">Design Visualization</h3>
                <button id="closeBodyVisualizationBtn" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            
            <div class="p-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Body Visualization -->
                    <div class="text-center">
                        <h4 class="font-semibold text-gray-700 mb-4">How it will look on you</h4>
                        <div id="bodyVisualization" class="bg-gray-50 rounded-lg p-6 min-h-96 flex items-center justify-center">
                            <!-- Body visualization will be generated here -->
                        </div>
                        <div id="measurementInfo" class="mt-4 text-sm text-gray-600">
                            <!-- Measurement info will be displayed here -->
                        </div>
                    </div>
                    
                    <!-- Design Details -->
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-4">Design Details</h4>
                        <div id="visualizationDesignDetails" class="space-y-4">
                            <!-- Design details will be populated here -->
                        </div>
                        <div class="mt-6 space-y-3">
                            <button id="addVisualizationToCart" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-medium">
                                Add to Cart
                            </button>
                            <button id="customizeDesign" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-medium">
                                Customize Design
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notifications" class="fixed top-20 right-6 z-50 space-y-2">
        <!-- Notifications will be added here -->
    </div>

    <!-- Footer -->
    <footer class="gradient-bg text-white mt-16">
        <div class="container mx-auto px-6 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">EmbroidTech</h3>
                    <p class="text-blue-100">Professional embroidery solutions for businesses and individuals worldwide.</p>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Services</h4>
                    <ul class="space-y-2 text-blue-100">
                        <li><a href="#" class="hover:text-white transition-colors">Custom Embroidery</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Logo Design</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Bulk Orders</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Rush Delivery</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Support</h4>
                    <ul class="space-y-2 text-blue-100">
                        <li><a href="#" class="hover:text-white transition-colors">Help Center</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Size Guide</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Shipping Info</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Returns</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Contact</h4>
                    <ul class="space-y-2 text-blue-100">
                        <li>📧 support@embroidtech.com</li>
                        <li>📞 +1 (555) 123-4567</li>
                        <li>🕒 Mon-Fri 9AM-6PM EST</li>
                        <li>🌐 24/7 Live Chat</li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-blue-400 mt-8 pt-8 text-center text-blue-100">
                <p>&copy; 2024 EmbroidTech. All rights reserved. | Privacy Policy | Terms of Service</p>
            </div>
        </div>
    </footer>

    <script>
        // Global variables
        let uploadedImages = [];
        let currentFilter = 'all';
        let currentView = 'grid';
        let cart = [];
        let wishlist = [];
        let currentUser = null;

        // Sample designs database with real embroidery designs
        const sampleDesigns = [
            {
                id: 1,
                name: "Rose Garden Embroidery",
                category: "floral",
                description: "Elegant rose garden design with intricate petal details and vibrant colors",
                price: "$25-45",
                time: "25-35 minutes",
                image: `<svg width="100" height="100" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="20" fill="#ff6b9d" stroke="#c44569" stroke-width="2"/>
                    <path d="M30 50 Q40 30 50 50 Q60 30 70 50" fill="#ff9ff3" stroke="#c44569"/>
                    <circle cx="45" cy="45" r="3" fill="#f8b500"/>
                    <path d="M35 60 Q50 70 65 60" stroke="#27ae60" stroke-width="2" fill="none"/>
                    <path d="M40 65 L45 70 M55 70 L60 65" stroke="#27ae60" stroke-width="1"/>
                </svg>`,
                gradient: "from-rose-200 to-pink-300",
                rating: 4.8,
                reviews: 124,
                keywords: ["floral", "rose", "garden", "elegant", "girl", "tshirt", "kurta", "dupatta"],
                garmentTypes: ["tshirt", "kurta", "dupatta", "saree"],
                isRealEmbroidery: true
            },
            {
                id: 9,
                name: "Traditional Mirror Work Anarkali",
                category: "mirror-work",
                description: "Exquisite mirror work embroidery perfect for anarkali suits with traditional ethnic appeal",
                price: "$65-95",
                time: "45-60 minutes",
                image: `<svg width="100" height="100" viewBox="0 0 100 100">
                    <defs>
                        <radialGradient id="mirror1" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" style="stop-color:#ffd700;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#ffed4e;stop-opacity:0.8" />
                        </radialGradient>
                    </defs>
                    <circle cx="30" cy="30" r="8" fill="url(#mirror1)" stroke="#d4af37" stroke-width="1"/>
                    <circle cx="70" cy="30" r="8" fill="url(#mirror1)" stroke="#d4af37" stroke-width="1"/>
                    <circle cx="50" cy="50" r="12" fill="url(#mirror1)" stroke="#d4af37" stroke-width="1"/>
                    <circle cx="30" cy="70" r="8" fill="url(#mirror1)" stroke="#d4af37" stroke-width="1"/>
                    <circle cx="70" cy="70" r="8" fill="url(#mirror1)" stroke="#d4af37" stroke-width="1"/>
                    <path d="M20 20 Q50 10 80 20 Q90 50 80 80 Q50 90 20 80 Q10 50 20 20" 
                          fill="none" stroke="#8b4513" stroke-width="2"/>
                </svg>`,
                gradient: "from-amber-200 to-yellow-300",
                rating: 4.9,
                reviews: 89,
                keywords: ["mirror work", "traditional", "anarkali", "ethnic", "wedding", "party", "shimmer", "gold"],
                garmentTypes: ["anarkali", "lehenga", "saree", "dupatta"],
                isRealEmbroidery: true
            },
            {
                id: 10,
                name: "Ethnic Paisley Mirror Design",
                category: "mirror-work", 
                description: "Beautiful paisley patterns with mirror work, ideal for traditional Indian wear",
                price: "$55-85",
                time: "40-55 minutes",
                image: `<svg width="100" height="100" viewBox="0 0 100 100">
                    <defs>
                        <radialGradient id="mirror2" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" style="stop-color:#ff6b9d;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#c44569;stop-opacity:0.8" />
                        </radialGradient>
                    </defs>
                    <path d="M30 20 Q60 10 70 40 Q65 70 40 75 Q20 65 25 40 Q28 25 30 20" 
                          fill="#9b59b6" stroke="#8e44ad" stroke-width="2"/>
                    <circle cx="45" cy="35" r="4" fill="url(#mirror2)" stroke="#d4af37"/>
                    <circle cx="50" cy="50" r="3" fill="url(#mirror2)" stroke="#d4af37"/>
                    <path d="M35 45 Q45 40 50 50" stroke="#f39c12" stroke-width="2" fill="none"/>
                    <circle cx="40" cy="60" r="2" fill="url(#mirror2)" stroke="#d4af37"/>
                </svg>`,
                gradient: "from-purple-200 to-pink-300",
                rating: 4.8,
                reviews: 156,
                keywords: ["paisley", "mirror work", "ethnic", "traditional", "indian", "anarkali", "lehenga"],
                garmentTypes: ["anarkali", "lehenga", "kurta", "saree"],
                isRealEmbroidery: true
            },
            {
                id: 2,
                name: "Corporate Logo Embroidery",
                category: "corporate",
                description: "Professional corporate logo embroidery with clean lines and modern appeal",
                price: "$35-65",
                time: "20-30 minutes",
                image: `<svg width="100" height="100" viewBox="0 0 100 100">
                    <rect x="20" y="30" width="60" height="40" rx="5" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
                    <rect x="30" y="40" width="15" height="20" fill="#ecf0f1"/>
                    <rect x="55" y="40" width="15" height="20" fill="#ecf0f1"/>
                    <circle cx="50" cy="25" r="8" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
                    <text x="50" y="85" text-anchor="middle" font-size="8" fill="#2c3e50">LOGO</text>
                </svg>`,
                gradient: "from-blue-200 to-indigo-300",
                rating: 4.9,
                reviews: 89,
                keywords: ["corporate", "logo", "tech", "startup", "modern", "professional", "business"],
                garmentTypes: ["tshirt", "polo", "jacket", "cap"],
                isRealEmbroidery: true
            },
            {
                id: 3,
                name: "Sports Team Embroidery",
                category: "sports",
                description: "Dynamic sports team embroidery with bold colors and athletic design",
                price: "$30-55",
                time: "22-32 minutes",
                image: `<svg width="100" height="100" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="25" fill="#e67e22" stroke="#d35400" stroke-width="3"/>
                    <path d="M35 35 Q50 25 65 35" stroke="#2c3e50" stroke-width="2" fill="none"/>
                    <path d="M35 65 Q50 75 65 65" stroke="#2c3e50" stroke-width="2" fill="none"/>
                    <path d="M35 50 L65 50" stroke="#2c3e50" stroke-width="2"/>
                    <circle cx="50" cy="50" r="5" fill="#2c3e50"/>
                    <text x="50" y="85" text-anchor="middle" font-size="8" fill="#e67e22" font-weight="bold">TEAM</text>
                </svg>`,
                gradient: "from-orange-200 to-red-300",
                rating: 4.7,
                reviews: 156,
                keywords: ["sports", "basketball", "team", "athletic", "bold", "dynamic"],
                garmentTypes: ["tshirt", "jersey", "hoodie", "cap"],
                isRealEmbroidery: true
            },
            {
                id: 4,
                name: "Mandala Embroidery Pattern",
                category: "custom",
                description: "Intricate mandala embroidery with geometric precision and spiritual symbolism",
                price: "$40-75",
                time: "35-50 minutes",
                image: `<svg width="100" height="100" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="30" fill="none" stroke="#9b59b6" stroke-width="2"/>
                    <circle cx="50" cy="50" r="20" fill="none" stroke="#8e44ad" stroke-width="1"/>
                    <circle cx="50" cy="50" r="10" fill="#9b59b6"/>
                    <g transform="rotate(0 50 50)">
                        <path d="M50 20 L55 35 L50 30 L45 35 Z" fill="#e74c3c"/>
                    </g>
                    <g transform="rotate(45 50 50)">
                        <path d="M50 20 L55 35 L50 30 L45 35 Z" fill="#f39c12"/>
                    </g>
                    <g transform="rotate(90 50 50)">
                        <path d="M50 20 L55 35 L50 30 L45 35 Z" fill="#e74c3c"/>
                    </g>
                    <g transform="rotate(135 50 50)">
                        <path d="M50 20 L55 35 L50 30 L45 35 Z" fill="#f39c12"/>
                    </g>
                    <g transform="rotate(180 50 50)">
                        <path d="M50 20 L55 35 L50 30 L45 35 Z" fill="#e74c3c"/>
                    </g>
                    <g transform="rotate(225 50 50)">
                        <path d="M50 20 L55 35 L50 30 L45 35 Z" fill="#f39c12"/>
                    </g>
                    <g transform="rotate(270 50 50)">
                        <path d="M50 20 L55 35 L50 30 L45 35 Z" fill="#e74c3c"/>
                    </g>
                    <g transform="rotate(315 50 50)">
                        <path d="M50 20 L55 35 L50 30 L45 35 Z" fill="#f39c12"/>
                    </g>
                </svg>`,
                gradient: "from-purple-200 to-indigo-300",
                rating: 4.9,
                reviews: 203,
                keywords: ["mandala", "geometric", "spiritual", "intricate", "pattern", "meditation"],
                garmentTypes: ["tshirt", "kurta", "dupatta", "bag"],
                isRealEmbroidery: true
            },
            {
                id: 5,
                name: "Sunflower Embroidery",
                category: "floral",
                description: "Bright sunflower embroidery perfect for summer apparel and accessories",
                price: "$20-40",
                time: "18-28 minutes",
                image: `<svg width="100" height="100" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="15" fill="#f39c12" stroke="#e67e22" stroke-width="2"/>
                    <circle cx="50" cy="50" r="8" fill="#d35400"/>
                    <g transform="rotate(0 50 50)">
                        <ellipse cx="50" cy="25" rx="4" ry="12" fill="#f1c40f"/>
                    </g>
                    <g transform="rotate(30 50 50)">
                        <ellipse cx="50" cy="25" rx="4" ry="12" fill="#f39c12"/>
                    </g>
                    <g transform="rotate(60 50 50)">
                        <ellipse cx="50" cy="25" rx="4" ry="12" fill="#f1c40f"/>
                    </g>
                    <g transform="rotate(90 50 50)">
                        <ellipse cx="50" cy="25" rx="4" ry="12" fill="#f39c12"/>
                    </g>
                    <g transform="rotate(120 50 50)">
                        <ellipse cx="50" cy="25" rx="4" ry="12" fill="#f1c40f"/>
                    </g>
                    <g transform="rotate(150 50 50)">
                        <ellipse cx="50" cy="25" rx="4" ry="12" fill="#f39c12"/>
                    </g>
                    <g transform="rotate(180 50 50)">
                        <ellipse cx="50" cy="25" rx="4" ry="12" fill="#f1c40f"/>
                    </g>
                    <g transform="rotate(210 50 50)">
                        <ellipse cx="50" cy="25" rx="4" ry="12" fill="#f39c12"/>
                    </g>
                    <g transform="rotate(240 50 50)">
                        <ellipse cx="50" cy="25" rx="4" ry="12" fill="#f1c40f"/>
                    </g>
                    <g transform="rotate(270 50 50)">
                        <ellipse cx="50" cy="25" rx="4" ry="12" fill="#f39c12"/>
                    </g>
                    <g transform="rotate(300 50 50)">
                        <ellipse cx="50" cy="25" rx="4" ry="12" fill="#f1c40f"/>
                    </g>
                    <g transform="rotate(330 50 50)">
                        <ellipse cx="50" cy="25" rx="4" ry="12" fill="#f39c12"/>
                    </g>
                    <path d="M50 75 L50 85" stroke="#27ae60" stroke-width="3"/>
                    <path d="M45 80 Q50 75 55 80" stroke="#27ae60" stroke-width="2" fill="none"/>
                </svg>`,
                gradient: "from-yellow-200 to-amber-300",
                rating: 4.6,
                reviews: 98,
                keywords: ["sunflower", "bright", "summer", "floral", "cheerful", "yellow"],
                garmentTypes: ["tshirt", "dress", "bag", "cap"],
                isRealEmbroidery: true
            },
            {
                id: 6,
                name: "Eagle Corporate Emblem",
                category: "corporate",
                description: "Powerful eagle emblem embroidery for corporate branding and official merchandise",
                price: "$45-80",
                time: "30-45 minutes",
                image: `<svg width="100" height="100" viewBox="0 0 100 100">
                    <path d="M50 20 Q30 30 20 50 Q30 40 50 45 Q70 40 80 50 Q70 30 50 20" fill="#8b4513" stroke="#654321" stroke-width="2"/>
                    <circle cx="40" cy="35" r="3" fill="#2c3e50"/>
                    <circle cx="60" cy="35" r="3" fill="#2c3e50"/>
                    <path d="M45 40 Q50 45 55 40" stroke="#e67e22" stroke-width="2" fill="none"/>
                    <path d="M20 50 Q10 60 15 70 Q25 65 30 60" fill="#34495e" stroke="#2c3e50"/>
                    <path d="M80 50 Q90 60 85 70 Q75 65 70 60" fill="#34495e" stroke="#2c3e50"/>
                    <path d="M35 60 Q50 70 65 60" stroke="#8b4513" stroke-width="2" fill="none"/>
                    <text x="50" y="85" text-anchor="middle" font-size="6" fill="#2c3e50" font-weight="bold">EXCELLENCE</text>
                </svg>`,
                gradient: "from-gray-200 to-slate-300",
                rating: 4.8,
                reviews: 67,
                keywords: ["eagle", "corporate", "emblem", "powerful", "official", "branding"],
                garmentTypes: ["polo", "jacket", "cap", "bag"],
                isRealEmbroidery: true
            },
            {
                id: 7,
                name: "Championship Soccer Embroidery",
                category: "sports",
                description: "Championship soccer embroidery with trophy and ball elements",
                price: "$28-50",
                time: "25-35 minutes",
                image: `<svg width="100" height="100" viewBox="0 0 100 100">
                    <circle cx="50" cy="40" r="18" fill="#ecf0f1" stroke="#2c3e50" stroke-width="2"/>
                    <path d="M35 30 L40 35 L35 40" stroke="#2c3e50" stroke-width="2" fill="none"/>
                    <path d="M65 30 L60 35 L65 40" stroke="#2c3e50" stroke-width="2" fill="none"/>
                    <path d="M45 25 Q50 20 55 25" stroke="#2c3e50" stroke-width="2" fill="none"/>
                    <path d="M45 55 Q50 60 55 55" stroke="#2c3e50" stroke-width="2" fill="none"/>
                    <rect x="45" y="65" width="10" height="15" fill="#f39c12" stroke="#e67e22" stroke-width="2"/>
                    <ellipse cx="50" cy="63" rx="8" ry="3" fill="#f1c40f"/>
                    <path d="M42 63 L58 63" stroke="#e67e22" stroke-width="1"/>
                    <text x="50" y="90" text-anchor="middle" font-size="6" fill="#27ae60" font-weight="bold">CHAMPION</text>
                </svg>`,
                gradient: "from-green-200 to-emerald-300",
                rating: 4.7,
                reviews: 134,
                keywords: ["soccer", "football", "championship", "trophy", "sports", "team"],
                garmentTypes: ["tshirt", "jersey", "hoodie", "shorts"],
                isRealEmbroidery: true
            },
            {
                id: 8,
                name: "Butterfly Garden Embroidery",
                category: "floral",
                description: "Delicate butterfly embroidery with floral elements and soft colors",
                price: "$22-42",
                time: "20-30 minutes",
                image: `<svg width="100" height="100" viewBox="0 0 100 100">
                    <ellipse cx="35" cy="35" rx="12" ry="8" fill="#ff6b9d" stroke="#c44569" stroke-width="1"/>
                    <ellipse cx="35" cy="50" rx="10" ry="6" fill="#ff9ff3" stroke="#c44569" stroke-width="1"/>
                    <ellipse cx="65" cy="35" rx="12" ry="8" fill="#ff6b9d" stroke="#c44569" stroke-width="1"/>
                    <ellipse cx="65" cy="50" rx="10" ry="6" fill="#ff9ff3" stroke="#c44569" stroke-width="1"/>
                    <path d="M50 30 L50 55" stroke="#2c3e50" stroke-width="2"/>
                    <circle cx="50" cy="28" r="2" fill="#2c3e50"/>
                    <path d="M48 25 Q50 20 52 25" stroke="#2c3e50" stroke-width="1" fill="none"/>
                    <circle cx="30" cy="32" r="2" fill="#f39c12"/>
                    <circle cx="70" cy="32" r="2" fill="#f39c12"/>
                    <path d="M25 70 Q35 65 30 75 Q40 70 35 80" stroke="#27ae60" stroke-width="2" fill="none"/>
                    <circle cx="28" cy="72" r="3" fill="#e74c3c"/>
                    <path d="M65 75 Q75 70 70 80 Q80 75 75 85" stroke="#27ae60" stroke-width="2" fill="none"/>
                    <circle cx="72" cy="77" r="3" fill="#f1c40f"/>
                </svg>`,
                gradient: "from-pink-200 to-purple-300",
                rating: 4.8,
                reviews: 178,
                keywords: ["butterfly", "garden", "delicate", "floral", "soft", "feminine", "girl"],
                garmentTypes: ["tshirt", "dress", "kurta", "dupatta"],
                isRealEmbroidery: true
            },
            {
                id: 11,
                name: "Lotus Mandala Embroidery",
                category: "traditional",
                description: "Sacred lotus mandala with traditional Indian embroidery techniques",
                price: "$50-80",
                time: "40-55 minutes",
                image: `<svg width="100" height="100" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="25" fill="none" stroke="#9b59b6" stroke-width="2"/>
                    <g transform="rotate(0 50 50)">
                        <ellipse cx="50" cy="25" rx="6" ry="15" fill="#e91e63" stroke="#ad1457" stroke-width="1"/>
                    </g>
                    <g transform="rotate(45 50 50)">
                        <ellipse cx="50" cy="25" rx="6" ry="15" fill="#f06292" stroke="#ad1457" stroke-width="1"/>
                    </g>
                    <g transform="rotate(90 50 50)">
                        <ellipse cx="50" cy="25" rx="6" ry="15" fill="#e91e63" stroke="#ad1457" stroke-width="1"/>
                    </g>
                    <g transform="rotate(135 50 50)">
                        <ellipse cx="50" cy="25" rx="6" ry="15" fill="#f06292" stroke="#ad1457" stroke-width="1"/>
                    </g>
                    <g transform="rotate(180 50 50)">
                        <ellipse cx="50" cy="25" rx="6" ry="15" fill="#e91e63" stroke="#ad1457" stroke-width="1"/>
                    </g>
                    <g transform="rotate(225 50 50)">
                        <ellipse cx="50" cy="25" rx="6" ry="15" fill="#f06292" stroke="#ad1457" stroke-width="1"/>
                    </g>
                    <g transform="rotate(270 50 50)">
                        <ellipse cx="50" cy="25" rx="6" ry="15" fill="#e91e63" stroke="#ad1457" stroke-width="1"/>
                    </g>
                    <g transform="rotate(315 50 50)">
                        <ellipse cx="50" cy="25" rx="6" ry="15" fill="#f06292" stroke="#ad1457" stroke-width="1"/>
                    </g>
                    <circle cx="50" cy="50" r="8" fill="#ffd700" stroke="#ff8f00" stroke-width="2"/>
                    <circle cx="50" cy="50" r="4" fill="#ff6f00"/>
                </svg>`,
                gradient: "from-pink-200 to-purple-300",
                rating: 4.9,
                reviews: 145,
                keywords: ["lotus", "mandala", "traditional", "sacred", "indian", "spiritual", "meditation"],
                garmentTypes: ["kurta", "saree", "dupatta", "lehenga"],
                isRealEmbroidery: true
            },
            {
                id: 12,
                name: "Peacock Feather Embroidery",
                category: "traditional",
                description: "Majestic peacock feather design with intricate thread work and beading",
                price: "$45-75",
                time: "35-50 minutes",
                image: `<svg width="100" height="100" viewBox="0 0 100 100">
                    <path d="M50 80 Q48 60 45 40 Q47 20 50 15 Q53 20 55 40 Q52 60 50 80" 
                          stroke="#27ae60" stroke-width="3" fill="none"/>
                    <ellipse cx="50" cy="25" rx="15" ry="20" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
                    <ellipse cx="50" cy="25" rx="10" ry="15" fill="#9b59b6" stroke="#8e44ad" stroke-width="1"/>
                    <ellipse cx="50" cy="25" rx="6" ry="10" fill="#e74c3c" stroke="#c0392b" stroke-width="1"/>
                    <circle cx="50" cy="25" r="3" fill="#f1c40f"/>
                    <circle cx="50" cy="25" r="1" fill="#2c3e50"/>
                    <path d="M35 30 Q25 35 30 45 Q40 40 45 35" fill="#27ae60" stroke="#229954" stroke-width="1"/>
                    <path d="M65 30 Q75 35 70 45 Q60 40 55 35" fill="#27ae60" stroke="#229954" stroke-width="1"/>
                    <path d="M40 50 Q30 55 35 65" stroke="#27ae60" stroke-width="2" fill="none"/>
                    <path d="M60 50 Q70 55 65 65" stroke="#27ae60" stroke-width="2" fill="none"/>
                </svg>`,
                gradient: "from-blue-200 to-green-300",
                rating: 4.8,
                reviews: 167,
                keywords: ["peacock", "feather", "traditional", "majestic", "indian", "royal", "elegant"],
                garmentTypes: ["saree", "lehenga", "anarkali", "dupatta"],
                isRealEmbroidery: true
            }
        ];

        // DOM elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadProgress = document.getElementById('uploadProgress');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const globalSearch = document.getElementById('globalSearch');
        const imageGallery = document.getElementById('imageGallery');
        const noResults = document.getElementById('noResults');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const gridViewBtn = document.getElementById('gridView');
        const listViewBtn = document.getElementById('listView');

        // Initialize the application
        function init() {
            setupEventListeners();
            renderGallery();
            updateCartDisplay();
        }

        // Setup all event listeners
        function setupEventListeners() {
            // Design option buttons
            document.getElementById('uploadBtn').addEventListener('click', () => {
                document.getElementById('uploadArea').classList.remove('hidden');
                document.getElementById('uploadArea').click();
            });
            
            document.getElementById('drawBtn').addEventListener('click', () => {
                document.getElementById('designEditorModal').classList.remove('hidden');
                initializeDrawingCanvas();
            });
            
            document.getElementById('aiGenerateBtn').addEventListener('click', () => {
                document.getElementById('aiGeneratorModal').classList.remove('hidden');
            });

            // Upload functionality
            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);
            fileInput.addEventListener('change', handleFileSelect);

            // Filter functionality
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    renderGallery();
                });
            });

            // Smart search functionality
            globalSearch.addEventListener('input', (e) => {
                const query = e.target.value;
                handleSmartSearch(query);
            });

            // View toggle
            gridViewBtn.addEventListener('click', () => toggleView('grid'));
            listViewBtn.addEventListener('click', () => toggleView('list'));

            // Chat functionality
            setupChatListeners();

            // Modal functionality
            setupModalListeners();

            // Cart functionality
            setupCartListeners();

            // Authentication
            setupAuthListeners();

            // Admin panel
            setupAdminListeners();

            // Checkout functionality
            setupCheckoutListeners();

            // Design editor functionality
            setupDesignEditorListeners();

            // AI generator functionality
            setupAIGeneratorListeners();
        }

        // Upload functionality
        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            processFiles(files);
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            processFiles(files);
        }

        function processFiles(files) {
            if (files.length === 0) return;

            uploadProgress.classList.remove('hidden');
            let processed = 0;

            files.forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageData = {
                            id: Date.now() + index,
                            name: file.name.split('.')[0],
                            src: e.target.result,
                            category: 'custom',
                            description: `Custom uploaded design: ${file.name}`,
                            price: "$30-60",
                            time: "25-40 minutes",
                            rating: 0,
                            reviews: 0,
                            isUploaded: true
                        };
                        
                        uploadedImages.push(imageData);
                        processed++;
                        
                        const progress = (processed / files.length) * 100;
                        progressBar.style.width = progress + '%';
                        progressText.textContent = `Uploading... ${processed}/${files.length}`;
                        
                        if (processed === files.length) {
                            setTimeout(() => {
                                uploadProgress.classList.add('hidden');
                                progressBar.style.width = '0%';
                                renderGallery();
                                showNotification('Images uploaded successfully!', 'success');
                            }, 500);
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // View toggle functionality
        function toggleView(view) {
            currentView = view;
            if (view === 'grid') {
                gridViewBtn.classList.add('bg-blue-500', 'text-white');
                gridViewBtn.classList.remove('bg-gray-300', 'text-gray-600');
                listViewBtn.classList.add('bg-gray-300', 'text-gray-600');
                listViewBtn.classList.remove('bg-blue-500', 'text-white');
            } else {
                listViewBtn.classList.add('bg-blue-500', 'text-white');
                listViewBtn.classList.remove('bg-gray-300', 'text-gray-600');
                gridViewBtn.classList.add('bg-gray-300', 'text-gray-600');
                gridViewBtn.classList.remove('bg-blue-500', 'text-white');
            }
            renderGallery();
        }

        // Render gallery
        function renderGallery(searchTerm = '') {
            let allImages = [...sampleDesigns, ...uploadedImages];

            // Filter images
            let filteredImages = allImages.filter(img => {
                const matchesFilter = currentFilter === 'all' || img.category === currentFilter;
                const matchesSearch = searchTerm === '' || 
                    img.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    img.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    img.category.toLowerCase().includes(searchTerm.toLowerCase());
                
                return matchesFilter && matchesSearch;
            });

            // Clear gallery
            imageGallery.innerHTML = '';

            if (filteredImages.length === 0) {
                noResults.classList.remove('hidden');
                return;
            } else {
                noResults.classList.add('hidden');
            }

            // Set gallery layout
            if (currentView === 'grid') {
                imageGallery.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6';
            } else {
                imageGallery.className = 'space-y-4';
            }

            // Render filtered images
            filteredImages.forEach(img => {
                const imageCard = createImageCard(img, currentView, searchTerm);
                imageGallery.appendChild(imageCard);
            });
        }

        function createImageCard(img, view, searchTerm = '') {
            const card = document.createElement('div');
            
            if (view === 'grid') {
                card.className = 'image-card bg-white rounded-xl shadow-lg overflow-hidden cursor-pointer';
                card.innerHTML = `
                    <div class="h-48 bg-gradient-to-br ${img.gradient || 'from-gray-200 to-gray-300'} flex items-center justify-center overflow-hidden">
                        ${img.isUploaded ? 
                            `<img src="${img.src}" alt="${img.name}" class="w-full h-full object-cover">` :
                            img.isRealEmbroidery ? 
                                `<div class="w-32 h-32">${img.image}</div>` :
                                `<div class="text-6xl">${img.image}</div>`
                        }
                    </div>
                    <div class="p-4">
                        <h4 class="font-semibold text-gray-800 mb-2">${highlightText(img.name, searchTerm)}</h4>
                        <p class="text-gray-600 text-sm mb-3">${highlightText(img.description, searchTerm)}</p>
                        <div class="flex justify-between items-center mb-3">
                            <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs capitalize">${img.category}</span>
                            <span class="font-bold text-green-600">${img.price}</span>
                        </div>
                        ${img.rating > 0 ? `
                        <div class="flex items-center justify-between text-sm text-gray-500">
                            <div class="flex items-center">
                                <span class="text-yellow-400">★</span>
                                <span class="ml-1">${img.rating} (${img.reviews})</span>
                            </div>
                            <span>${img.time}</span>
                        </div>
                        ` : ''}
                    </div>
                `;
            } else {
                card.className = 'image-card bg-white rounded-xl shadow-lg overflow-hidden flex cursor-pointer';
                card.innerHTML = `
                    <div class="w-32 h-32 bg-gradient-to-br ${img.gradient || 'from-gray-200 to-gray-300'} flex items-center justify-center overflow-hidden flex-shrink-0">
                        ${img.isUploaded ? 
                            `<img src="${img.src}" alt="${img.name}" class="w-full h-full object-cover">` :
                            img.isRealEmbroidery ? 
                                `<div class="w-20 h-20">${img.image}</div>` :
                                `<div class="text-4xl">${img.image}</div>`
                        }
                    </div>
                    <div class="p-4 flex-1">
                        <h4 class="font-semibold text-gray-800 mb-2">${highlightText(img.name, searchTerm)}</h4>
                        <p class="text-gray-600 text-sm mb-3">${highlightText(img.description, searchTerm)}</p>
                        <div class="flex justify-between items-center">
                            <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs capitalize">${img.category}</span>
                            <span class="font-bold text-green-600">${img.price}</span>
                        </div>
                    </div>
                `;
            }
            
            card.addEventListener('click', () => openImageModal(img));
            return card;
        }

        function highlightText(text, searchTerm) {
            if (!searchTerm) return text;
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }

        // Modal functionality
        function setupModalListeners() {
            const imageModal = document.getElementById('imageModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const addToCartBtn = document.getElementById('addToCartBtn');
            const addToWishlistBtn = document.getElementById('addToWishlistBtn');

            closeModalBtn.addEventListener('click', () => {
                imageModal.classList.add('hidden');
            });

            imageModal.addEventListener('click', (e) => {
                if (e.target === imageModal) {
                    imageModal.classList.add('hidden');
                }
            });

            addToCartBtn.addEventListener('click', () => {
                const currentDesign = imageModal.currentDesign;
                if (currentDesign) {
                    addToCart(currentDesign);
                    imageModal.classList.add('hidden');
                }
            });

            addToWishlistBtn.addEventListener('click', () => {
                const currentDesign = imageModal.currentDesign;
                if (currentDesign) {
                    addToWishlist(currentDesign);
                }
            });
        }

        function openImageModal(design) {
            const modal = document.getElementById('imageModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalImage = document.getElementById('modalImage');
            const modalDescription = document.getElementById('modalDescription');
            const modalCategory = document.getElementById('modalCategory');
            const modalPrice = document.getElementById('modalPrice');
            const modalTime = document.getElementById('modalTime');

            modalTitle.textContent = design.name;
            modalDescription.textContent = design.description;
            modalCategory.textContent = design.category;
            modalPrice.textContent = design.price;
            modalTime.textContent = design.time;

            if (design.isUploaded) {
                modalImage.innerHTML = `<img src="${design.src}" alt="${design.name}" class="w-full h-full object-cover rounded-lg">`;
            } else {
                modalImage.innerHTML = `<div class="w-full h-full bg-gradient-to-br ${design.gradient} flex items-center justify-center rounded-lg"><div class="text-8xl">${design.image}</div></div>`;
            }

            modal.currentDesign = design;
            modal.classList.remove('hidden');
        }

        // Cart functionality
        function setupCartListeners() {
            const cartBtn = document.getElementById('cartBtn');
            const cartModal = document.getElementById('cartModal');
            const closeCartBtn = document.getElementById('closeCartBtn');
            const checkoutBtn = document.getElementById('checkoutBtn');

            cartBtn.addEventListener('click', () => {
                renderCartItems();
                cartModal.classList.remove('hidden');
            });

            closeCartBtn.addEventListener('click', () => {
                cartModal.classList.add('hidden');
            });

            checkoutBtn.addEventListener('click', () => {
                if (cart.length === 0) {
                    showNotification('Your cart is empty!', 'error');
                    return;
                }
                cartModal.classList.add('hidden');
                openCheckoutModal();
            });
        }

        function addToCart(design) {
            const existingItem = cart.find(item => item.id === design.id);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    ...design,
                    quantity: 1,
                    unitPrice: parseFloat(design.price.split('-')[0].replace('$', ''))
                });
            }
            updateCartDisplay();
            showNotification(`${design.name} added to cart!`, 'success');
        }

        function removeFromCart(designId) {
            cart = cart.filter(item => item.id !== designId);
            updateCartDisplay();
            renderCartItems();
            showNotification('Item removed from cart', 'info');
        }

        function updateCartQuantity(designId, newQuantity) {
            const item = cart.find(item => item.id === designId);
            if (item) {
                if (newQuantity <= 0) {
                    removeFromCart(designId);
                } else {
                    item.quantity = newQuantity;
                    updateCartDisplay();
                    renderCartItems();
                }
            }
        }

        function updateCartDisplay() {
            const cartCount = document.getElementById('cartCount');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            if (totalItems > 0) {
                cartCount.textContent = totalItems;
                cartCount.classList.remove('hidden');
            } else {
                cartCount.classList.add('hidden');
            }
        }

        function renderCartItems() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="text-gray-500 text-center py-8">Your cart is empty</p>';
                cartTotal.textContent = '$0.00';
                return;
            }

            let total = 0;
            cartItems.innerHTML = cart.map(item => {
                const itemTotal = item.unitPrice * item.quantity;
                total += itemTotal;
                
                return `
                    <div class="flex items-center space-x-4 p-4 border rounded-lg">
                        <div class="w-16 h-16 bg-gradient-to-br ${item.gradient || 'from-gray-200 to-gray-300'} rounded-lg flex items-center justify-center">
                            ${item.isUploaded ? 
                                `<img src="${item.src}" alt="${item.name}" class="w-full h-full object-cover rounded-lg">` :
                                `<div class="text-2xl">${item.image}</div>`
                            }
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800">${item.name}</h4>
                            <p class="text-sm text-gray-600">${item.category}</p>
                            <p class="font-bold text-green-600">$${item.unitPrice.toFixed(2)} each</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="updateCartQuantity(${item.id}, ${item.quantity - 1})" class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300">-</button>
                            <span class="w-8 text-center font-medium">${item.quantity}</span>
                            <button onclick="updateCartQuantity(${item.id}, ${item.quantity + 1})" class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300">+</button>
                        </div>
                        <div class="text-right">
                            <p class="font-bold">$${itemTotal.toFixed(2)}</p>
                            <button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700 text-sm">Remove</button>
                        </div>
                    </div>
                `;
            }).join('');

            cartTotal.textContent = `$${total.toFixed(2)}`;
        }

        // Wishlist functionality
        function addToWishlist(design) {
            const existingItem = wishlist.find(item => item.id === design.id);
            if (!existingItem) {
                wishlist.push(design);
                showNotification(`${design.name} added to wishlist!`, 'success');
            } else {
                showNotification('Item already in wishlist', 'info');
            }
        }

        // Chat functionality
        function setupChatListeners() {
            const chatButton = document.getElementById('chatButton');
            const chatWindow = document.getElementById('chatWindow');
            const closeChatBtn = document.getElementById('closeChatBtn');
            const chatInput = document.getElementById('chatInput');
            const sendChatBtn = document.getElementById('sendChatBtn');
            const chatMessages = document.getElementById('chatMessages');

            chatButton.addEventListener('click', () => {
                chatWindow.classList.toggle('hidden');
            });

            closeChatBtn.addEventListener('click', () => {
                chatWindow.classList.add('hidden');
            });

            function sendMessage() {
                const message = chatInput.value.trim();
                if (message === '') return;

                // Add user message
                const userMsg = document.createElement('div');
                userMsg.className = 'flex items-start space-x-2 justify-end';
                userMsg.innerHTML = `
                    <div class="bg-blue-500 text-white rounded-lg p-3 max-w-xs">
                        <p class="text-sm">${message}</p>
                    </div>
                    <div class="w-8 h-8 bg-gray-400 rounded-full flex items-center justify-center text-white text-sm font-semibold">U</div>
                `;
                chatMessages.appendChild(userMsg);

                chatInput.value = '';

                // Generate bot response
                setTimeout(() => {
                    const botMsg = document.createElement('div');
                    botMsg.className = 'flex items-start space-x-2';
                    
                    let response = generateChatResponse(message);

                    botMsg.innerHTML = `
                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-semibold">AI</div>
                        <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                            <p class="text-sm">${response}</p>
                        </div>
                    `;
                    chatMessages.appendChild(botMsg);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1000);

                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            sendChatBtn.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        }

        function generateChatResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Check for design creation requests
            if (lowerMessage.includes('create') && (lowerMessage.includes('design') || lowerMessage.includes('floral') || lowerMessage.includes('tshirt') || lowerMessage.includes('t-shirt'))) {
                setTimeout(() => {
                    const actionBtns = document.createElement('div');
                    actionBtns.className = 'flex flex-col space-y-2 mt-3';
                    actionBtns.innerHTML = `
                        <button onclick="openAIGenerator('${message}')" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors text-sm">
                            🎨 Generate with AI
                        </button>
                        <button onclick="openDesignGallery('floral')" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors text-sm">
                            👀 Browse Floral Designs
                        </button>
                        <button onclick="connectToAgent()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors text-sm">
                            👨‍💼 Talk to Live Agent
                        </button>
                    `;
                    
                    const lastBotMessage = document.querySelector('#chatMessages .flex:last-child .bg-gray-100');
                    if (lastBotMessage) {
                        lastBotMessage.appendChild(actionBtns);
                    }
                }, 100);
                
                return "I can help you create that design! I found you want a floral design for a girl's t-shirt. Here are your options:";
            }
            
            if (lowerMessage.includes('price') || lowerMessage.includes('cost')) {
                return "Our pricing ranges from $20-80 depending on design complexity. Simple designs start at $20, while intricate custom work can go up to $80. Would you like a specific quote?";
            } else if (lowerMessage.includes('time') || lowerMessage.includes('delivery')) {
                return "Standard orders take 5-7 business days. We offer rush delivery (1-2 days) for 50% extra. Bulk orders may take longer. What's your timeline?";
            } else if (lowerMessage.includes('design') || lowerMessage.includes('custom')) {
                return "We create custom designs from your images or ideas! Upload your design or describe what you want, and our team will create a perfect embroidery pattern for you.";
            } else if (lowerMessage.includes('upload') || lowerMessage.includes('file')) {
                return "You can upload images in JPG, PNG, or GIF format up to 10MB. Just drag and drop or click the upload area above. We'll convert it to an embroidery-ready design!";
            } else if (lowerMessage.includes('payment') || lowerMessage.includes('pay')) {
                return "We accept all major credit cards, UPI payments, and digital wallets. All payments are secured with 256-bit encryption and mobile OTP verification.";
            } else if (lowerMessage.includes('shipping') || lowerMessage.includes('location')) {
                return "We ship worldwide! Domestic orders arrive in 3-5 days, international in 7-14 days. Free shipping on orders over $100. Track your order anytime!";
            } else if (lowerMessage.includes('help') || lowerMessage.includes('support')) {
                return "I'm here to help! You can ask about pricing, delivery times, custom designs, file uploads, payments, or anything else. What would you like to know?";
            } else if (lowerMessage.includes('draw') || lowerMessage.includes('editor')) {
                setTimeout(() => {
                    const actionBtn = document.createElement('div');
                    actionBtn.className = 'mt-3';
                    actionBtn.innerHTML = `
                        <button onclick="openDrawingEditor()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors text-sm">
                            🎨 Open Drawing Editor
                        </button>
                    `;
                    
                    const lastBotMessage = document.querySelector('#chatMessages .flex:last-child .bg-gray-100');
                    if (lastBotMessage) {
                        lastBotMessage.appendChild(actionBtn);
                    }
                }, 100);
                
                return "You can use our advanced drawing editor to create custom designs! It includes brush tools, shapes, and live preview on different garments.";
            } else {
                return "Thanks for your message! I can help with pricing, delivery times, custom designs, file uploads, and more. What specific information do you need?";
            }
        }

        // Chat action functions
        window.openAIGenerator = function(prompt) {
            document.getElementById('chatWindow').classList.add('hidden');
            document.getElementById('aiGeneratorModal').classList.remove('hidden');
            document.getElementById('aiPrompt').value = prompt || '';
        };

        window.openDesignGallery = function(category) {
            document.getElementById('chatWindow').classList.add('hidden');
            // Filter gallery by category
            currentFilter = category;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === category) {
                    btn.classList.add('active');
                }
            });
            renderGallery();
            // Scroll to gallery
            document.getElementById('gallery').scrollIntoView({ behavior: 'smooth' });
        };

        window.connectToAgent = function() {
            document.getElementById('chatWindow').classList.add('hidden');
            showNotification('Connecting you to a live agent...', 'info');
            
            setTimeout(() => {
                document.getElementById('chatWindow').classList.remove('hidden');
                const chatMessages = document.getElementById('chatMessages');
                const agentMsg = document.createElement('div');
                agentMsg.className = 'flex items-start space-x-2';
                agentMsg.innerHTML = `
                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-sm font-semibold">👨‍💼</div>
                    <div class="bg-green-100 rounded-lg p-3 max-w-xs">
                        <p class="text-sm"><strong>Live Agent Sarah:</strong> Hi! I'm here to help you with your floral t-shirt design. I can create a custom design for you or help you choose from our existing collection. What would you prefer?</p>
                    </div>
                `;
                chatMessages.appendChild(agentMsg);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 2000);
        };

        window.openDrawingEditor = function() {
            document.getElementById('chatWindow').classList.add('hidden');
            document.getElementById('designEditorModal').classList.remove('hidden');
            initializeDrawingCanvas();
        };

        // Authentication functionality
        function setupAuthListeners() {
            const loginBtn = document.getElementById('loginBtn');
            const loginModal = document.getElementById('loginModal');
            const closeLoginBtn = document.getElementById('closeLoginBtn');
            const loginForm = document.getElementById('loginForm');
            const showRegisterBtn = document.getElementById('showRegisterBtn');

            loginBtn.addEventListener('click', () => {
                loginModal.classList.remove('hidden');
            });

            closeLoginBtn.addEventListener('click', () => {
                loginModal.classList.add('hidden');
            });

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                // Simulate login
                currentUser = {
                    email: email,
                    name: email.split('@')[0],
                    id: Date.now()
                };
                
                loginModal.classList.add('hidden');
                updateAuthDisplay();
                showNotification('Login successful!', 'success');
            });

            showRegisterBtn.addEventListener('click', () => {
                showNotification('Registration feature coming soon!', 'info');
            });
        }

        function updateAuthDisplay() {
            const loginBtn = document.getElementById('loginBtn');
            if (currentUser) {
                loginBtn.textContent = `Hi, ${currentUser.name}`;
                loginBtn.onclick = () => {
                    currentUser = null;
                    updateAuthDisplay();
                    showNotification('Logged out successfully', 'info');
                };
            } else {
                loginBtn.textContent = 'Login';
                loginBtn.onclick = () => {
                    document.getElementById('loginModal').classList.remove('hidden');
                };
            }
        }

        // Checkout functionality
        function setupCheckoutListeners() {
            const checkoutModal = document.getElementById('checkoutModal');
            const closeCheckoutBtn = document.getElementById('closeCheckoutBtn');
            const checkoutForm = document.getElementById('checkoutForm');

            closeCheckoutBtn.addEventListener('click', () => {
                checkoutModal.classList.add('hidden');
            });

            checkoutForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const phone = document.getElementById('checkoutPhone').value;
                
                if (!phone) {
                    showNotification('Please enter your phone number', 'error');
                    return;
                }
                
                // Validate payment method and details
                if (!validatePaymentDetails()) {
                    return;
                }
                
                checkoutModal.classList.add('hidden');
                processSelectedPayment(phone);
            });

            // Setup payment method switching
            setupPaymentMethodListeners();
        }

        function setupPaymentMethodListeners() {
            const paymentRadios = document.querySelectorAll('input[name="payment"]');
            const paymentForms = document.querySelectorAll('.payment-form');

            paymentRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    // Hide all payment forms
                    paymentForms.forEach(form => form.classList.add('hidden'));
                    
                    // Show selected payment form
                    const selectedForm = document.getElementById(e.target.value + 'PaymentForm');
                    if (selectedForm) {
                        selectedForm.classList.remove('hidden');
                    }

                    // Update EMI amounts if BNPL is selected
                    if (e.target.value === 'bnpl') {
                        updateEMIAmounts();
                    }
                });
            });

            // Card number formatting
            const cardNumberInput = document.getElementById('cardNumber');
            if (cardNumberInput) {
                cardNumberInput.addEventListener('input', formatCardNumber);
            }

            // Expiry date formatting
            const expiryInput = document.getElementById('expiryDate');
            if (expiryInput) {
                expiryInput.addEventListener('input', formatExpiryDate);
            }

            // CVV validation
            const cvvInput = document.getElementById('cvv');
            if (cvvInput) {
                cvvInput.addEventListener('input', formatCVV);
            }

            // UPI quick buttons
            document.querySelectorAll('.upi-quick-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const app = btn.dataset.app;
                    selectUPIApp(app);
                });
            });

            // Wallet buttons
            document.querySelectorAll('.wallet-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const wallet = btn.dataset.wallet;
                    selectWallet(wallet);
                });
            });
        }

        function formatCardNumber(e) {
            let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
            e.target.value = formattedValue;
        }

        function formatExpiryDate(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            e.target.value = value;
        }

        function formatCVV(e) {
            e.target.value = e.target.value.replace(/[^0-9]/g, '');
        }

        function selectUPIApp(app) {
            // Remove previous selections
            document.querySelectorAll('.upi-quick-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Select current app
            const selectedBtn = document.querySelector(`[data-app="${app}"]`);
            selectedBtn.classList.add('selected');
            
            // Auto-fill UPI ID placeholder
            const upiInput = document.getElementById('upiId');
            const placeholders = {
                gpay: 'yourname@okaxis',
                phonepe: 'yourname@ybl',
                paytm: 'yourname@paytm'
            };
            upiInput.placeholder = placeholders[app] || 'yourname@upi';
        }

        function selectWallet(wallet) {
            // Remove previous selections
            document.querySelectorAll('.wallet-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Select current wallet
            const selectedBtn = document.querySelector(`[data-wallet="${wallet}"]`);
            selectedBtn.classList.add('selected');
        }

        function updateEMIAmounts() {
            const total = cart.reduce((sum, item) => sum + (item.unitPrice * item.quantity), 0);
            
            document.getElementById('emi3Amount').textContent = `$${(total / 3).toFixed(2)}/month`;
            document.getElementById('emi6Amount').textContent = `$${(total / 6).toFixed(2)}/month`;
            document.getElementById('emi12Amount').textContent = `$${(total / 12).toFixed(2)}/month`;
        }

        function validatePaymentDetails() {
            const selectedPayment = document.querySelector('input[name="payment"]:checked').value;
            
            switch (selectedPayment) {
                case 'card':
                    return validateCardDetails();
                case 'upi':
                    return validateUPIDetails();
                case 'netbanking':
                    return validateNetBankingDetails();
                case 'wallet':
                    return validateWalletDetails();
                case 'bnpl':
                    return validateBNPLDetails();
                default:
                    return false;
            }
        }

        function validateCardDetails() {
            const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
            const expiryDate = document.getElementById('expiryDate').value;
            const cvv = document.getElementById('cvv').value;
            const cardholderName = document.getElementById('cardholderName').value;

            if (!cardNumber || cardNumber.length < 13) {
                showNotification('Please enter a valid card number', 'error');
                return false;
            }

            if (!expiryDate || !expiryDate.match(/^\d{2}\/\d{2}$/)) {
                showNotification('Please enter a valid expiry date (MM/YY)', 'error');
                return false;
            }

            if (!cvv || cvv.length < 3) {
                showNotification('Please enter a valid CVV', 'error');
                return false;
            }

            if (!cardholderName.trim()) {
                showNotification('Please enter cardholder name', 'error');
                return false;
            }

            return true;
        }

        function validateUPIDetails() {
            const upiId = document.getElementById('upiId').value;
            const selectedApp = document.querySelector('.upi-quick-btn.selected');

            if (!upiId && !selectedApp) {
                showNotification('Please enter UPI ID or select a quick pay option', 'error');
                return false;
            }

            if (upiId && !upiId.includes('@')) {
                showNotification('Please enter a valid UPI ID', 'error');
                return false;
            }

            return true;
        }

        function validateNetBankingDetails() {
            const selectedBank = document.getElementById('bankSelect').value;

            if (!selectedBank) {
                showNotification('Please select your bank', 'error');
                return false;
            }

            return true;
        }

        function validateWalletDetails() {
            const selectedWallet = document.querySelector('.wallet-btn.selected');

            if (!selectedWallet) {
                showNotification('Please select a wallet', 'error');
                return false;
            }

            return true;
        }

        function validateBNPLDetails() {
            const selectedEMI = document.querySelector('input[name="emi"]:checked');

            if (!selectedEMI) {
                showNotification('Please select an EMI option', 'error');
                return false;
            }

            return true;
        }

        function processSelectedPayment(phone) {
            const selectedPayment = document.querySelector('input[name="payment"]:checked').value;
            const total = cart.reduce((sum, item) => sum + (item.unitPrice * item.quantity), 0);

            switch (selectedPayment) {
                case 'card':
                    processCardPayment(phone, total);
                    break;
                case 'upi':
                    processUPIPayment(phone, total);
                    break;
                case 'netbanking':
                    processNetBankingPayment(phone, total);
                    break;
                case 'wallet':
                    processWalletPayment(phone, total);
                    break;
                case 'bnpl':
                    processBNPLPayment(phone, total);
                    break;
            }
        }

        function processCardPayment(phone, total) {
            showPaymentProcessing('Processing card payment...');
            
            setTimeout(() => {
                openOtpModal(phone);
            }, 2000);
        }

        function processUPIPayment(phone, total) {
            const selectedApp = document.querySelector('.upi-quick-btn.selected');
            const upiId = document.getElementById('upiId').value;

            if (selectedApp) {
                const app = selectedApp.dataset.app;
                showPaymentProcessing(`Opening ${app.charAt(0).toUpperCase() + app.slice(1)}...`);
                
                setTimeout(() => {
                    showUPIPaymentModal(app, total);
                }, 1500);
            } else {
                showPaymentProcessing('Processing UPI payment...');
                
                setTimeout(() => {
                    openOtpModal(phone);
                }, 2000);
            }
        }

        function processNetBankingPayment(phone, total) {
            const selectedBank = document.getElementById('bankSelect').value;
            const bankNames = {
                sbi: 'State Bank of India',
                hdfc: 'HDFC Bank',
                icici: 'ICICI Bank',
                axis: 'Axis Bank',
                kotak: 'Kotak Mahindra Bank',
                pnb: 'Punjab National Bank',
                bob: 'Bank of Baroda',
                canara: 'Canara Bank'
            };

            showPaymentProcessing(`Redirecting to ${bankNames[selectedBank]}...`);
            
            setTimeout(() => {
                showBankingModal(bankNames[selectedBank], total, phone);
            }, 2000);
        }

        function processWalletPayment(phone, total) {
            const selectedWallet = document.querySelector('.wallet-btn.selected');
            const wallet = selectedWallet.dataset.wallet;
            const walletNames = {
                paypal: 'PayPal',
                razorpay: 'Razorpay Wallet'
            };

            showPaymentProcessing(`Opening ${walletNames[wallet]}...`);
            
            setTimeout(() => {
                showWalletModal(walletNames[wallet], total, phone);
            }, 1500);
        }

        function processBNPLPayment(phone, total) {
            const selectedEMI = document.querySelector('input[name="emi"]:checked');
            const emiMonths = selectedEMI.value;

            showPaymentProcessing('Setting up your EMI plan...');
            
            setTimeout(() => {
                showBNPLConfirmation(emiMonths, total, phone);
            }, 2000);
        }

        function showPaymentProcessing(message) {
            const processingModal = document.createElement('div');
            processingModal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            processingModal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4 text-center">
                    <div class="payment-processing w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"></div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Processing Payment</h3>
                    <p class="text-gray-600">${message}</p>
                    <div class="mt-4 flex items-center justify-center space-x-2">
                        <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div>
                        <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                        <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(processingModal);
            
            // Remove after processing
            setTimeout(() => {
                processingModal.remove();
            }, 3000);
        }

        function showUPIPaymentModal(app, total) {
            const upiModal = document.createElement('div');
            upiModal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            upiModal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4 text-center">
                    <div class="w-20 h-20 bg-gradient-to-r from-green-400 to-blue-500 rounded-full mx-auto mb-4 flex items-center justify-center">
                        <span class="text-2xl text-white font-bold">${app.charAt(0).toUpperCase()}</span>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">${app.charAt(0).toUpperCase() + app.slice(1)} Payment</h3>
                    <p class="text-gray-600 mb-4">Amount: <span class="font-bold text-green-600">$${total.toFixed(2)}</span></p>
                    <div class="bg-gray-100 p-4 rounded-lg mb-4">
                        <p class="text-sm text-gray-600 mb-2">Scan QR Code or</p>
                        <div class="w-32 h-32 bg-white border-2 border-dashed border-gray-300 rounded-lg mx-auto mb-3 flex items-center justify-center">
                            <span class="text-4xl">📱</span>
                        </div>
                        <button onclick="simulateUPISuccess()" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">
                            ✓ Simulate Payment Success
                        </button>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-gray-500 hover:text-gray-700">Cancel</button>
                </div>
            `;
            
            document.body.appendChild(upiModal);
        }

        function showBankingModal(bankName, total, phone) {
            const bankModal = document.createElement('div');
            bankModal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            bankModal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-blue-600 rounded-lg mx-auto mb-4 flex items-center justify-center">
                            <span class="text-white font-bold text-xl">🏦</span>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800">${bankName}</h3>
                        <p class="text-gray-600">Secure Internet Banking</p>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">User ID</label>
                            <input type="text" placeholder="Enter your user ID" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                            <input type="password" placeholder="Enter your password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <p class="text-sm text-blue-800">Amount to pay: <span class="font-bold">$${total.toFixed(2)}</span></p>
                        </div>
                        <button onclick="simulateBankingSuccess('${phone}')" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                            🔒 Pay Securely
                        </button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="w-full text-gray-500 hover:text-gray-700">Cancel</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(bankModal);
        }

        function showWalletModal(walletName, total, phone) {
            const walletModal = document.createElement('div');
            walletModal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            walletModal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4 text-center">
                    <div class="w-20 h-20 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full mx-auto mb-4 flex items-center justify-center">
                        <span class="text-2xl text-white">💳</span>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">${walletName}</h3>
                    <p class="text-gray-600 mb-4">Amount: <span class="font-bold text-green-600">$${total.toFixed(2)}</span></p>
                    <div class="bg-gray-100 p-4 rounded-lg mb-4">
                        <p class="text-sm text-gray-600 mb-3">You will be redirected to ${walletName} to complete the payment</p>
                        <button onclick="simulateWalletSuccess('${phone}')" class="bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                            Continue to ${walletName}
                        </button>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-gray-500 hover:text-gray-700">Cancel</button>
                </div>
            `;
            
            document.body.appendChild(walletModal);
        }

        function showBNPLConfirmation(emiMonths, total, phone) {
            const monthlyAmount = (total / emiMonths).toFixed(2);
            const bnplModal = document.createElement('div');
            bnplModal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            bnplModal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-orange-500 rounded-lg mx-auto mb-4 flex items-center justify-center">
                            <span class="text-white font-bold text-xl">📅</span>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800">EMI Plan Confirmation</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="text-gray-600">Total Amount</p>
                                    <p class="font-bold text-lg">$${total.toFixed(2)}</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Monthly EMI</p>
                                    <p class="font-bold text-lg text-green-600">$${monthlyAmount}</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Duration</p>
                                    <p class="font-bold">${emiMonths} months</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Interest Rate</p>
                                    <p class="font-bold text-green-600">0% (First 3 months)</p>
                                </div>
                            </div>
                        </div>
                        <div class="text-xs text-gray-600">
                            <p>• First payment due in 30 days</p>
                            <p>• No prepayment charges</p>
                            <p>• Auto-debit from your account</p>
                        </div>
                        <button onclick="simulateBNPLSuccess('${phone}')" class="w-full bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition-colors">
                            ✓ Confirm EMI Plan
                        </button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="w-full text-gray-500 hover:text-gray-700">Cancel</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(bnplModal);
        }

        // Global functions for payment simulation
        window.simulateUPISuccess = function() {
            document.querySelectorAll('.fixed.inset-0').forEach(modal => modal.remove());
            showNotification('UPI payment successful! 🎉', 'success');
            completePayment();
        };

        window.simulateBankingSuccess = function(phone) {
            document.querySelectorAll('.fixed.inset-0').forEach(modal => modal.remove());
            openOtpModal(phone);
        };

        window.simulateWalletSuccess = function(phone) {
            document.querySelectorAll('.fixed.inset-0').forEach(modal => modal.remove());
            showNotification('Wallet payment successful! 🎉', 'success');
            completePayment();
        };

        window.simulateBNPLSuccess = function(phone) {
            document.querySelectorAll('.fixed.inset-0').forEach(modal => modal.remove());
            showNotification('EMI plan activated successfully! 🎉', 'success');
            completePayment();
        };

        function completePayment() {
            const orderId = 'ORD' + Date.now();
            cart = [];
            updateCartDisplay();
            
            setTimeout(() => {
                showOrderConfirmation(orderId);
            }, 1000);
        }

        function showOrderConfirmation(orderId) {
            const confirmationModal = document.createElement('div');
            confirmationModal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            confirmationModal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4 text-center">
                    <div class="w-20 h-20 bg-green-500 rounded-full mx-auto mb-4 flex items-center justify-center">
                        <span class="text-3xl text-white">✓</span>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Payment Successful!</h3>
                    <p class="text-gray-600 mb-4">Your order has been confirmed</p>
                    <div class="bg-green-50 p-4 rounded-lg mb-4">
                        <p class="text-sm text-green-800">Order ID: <span class="font-bold">${orderId}</span></p>
                        <p class="text-sm text-green-800 mt-1">Estimated delivery: 5-7 business days</p>
                    </div>
                    <div class="space-y-2">
                        <button onclick="this.parentElement.parentElement.remove()" class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition-colors">
                            Continue Shopping
                        </button>
                        <button onclick="trackOrder('${orderId}')" class="w-full text-green-600 hover:text-green-700 py-2">
                            Track Your Order
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmationModal);
        }

        window.trackOrder = function(orderId) {
            document.querySelectorAll('.fixed.inset-0').forEach(modal => modal.remove());
            showNotification(`Order ${orderId} is being prepared for shipment`, 'info');
        };

        function openCheckoutModal() {
            const checkoutModal = document.getElementById('checkoutModal');
            const checkoutTotal = document.getElementById('checkoutTotal');
            
            const total = cart.reduce((sum, item) => sum + (item.unitPrice * item.quantity), 0);
            checkoutTotal.textContent = `$${total.toFixed(2)}`;
            
            checkoutModal.classList.remove('hidden');
        }

        function openOtpModal(phone) {
            const otpModal = document.getElementById('otpModal');
            const otpPhone = document.getElementById('otpPhone');
            const verifyOtpBtn = document.getElementById('verifyOtpBtn');
            const resendOtpBtn = document.getElementById('resendOtpBtn');
            const otpInputs = document.querySelectorAll('.otp-input');

            otpPhone.textContent = phone;
            otpModal.classList.remove('hidden');

            // Auto-focus and move between OTP inputs
            otpInputs.forEach((input, index) => {
                input.addEventListener('input', (e) => {
                    if (e.target.value && index < otpInputs.length - 1) {
                        otpInputs[index + 1].focus();
                    }
                });
                
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && !e.target.value && index > 0) {
                        otpInputs[index - 1].focus();
                    }
                });
            });

            verifyOtpBtn.addEventListener('click', () => {
                const otp = Array.from(otpInputs).map(input => input.value).join('');
                if (otp.length === 6) {
                    // Simulate payment processing
                    otpModal.classList.add('hidden');
                    processPayment();
                } else {
                    showNotification('Please enter complete OTP', 'error');
                }
            });

            resendOtpBtn.addEventListener('click', () => {
                showNotification('OTP resent successfully!', 'success');
            });

            // Auto-fill demo OTP after 2 seconds
            setTimeout(() => {
                otpInputs.forEach((input, index) => {
                    input.value = '123456'[index];
                });
                showNotification('Demo OTP: 123456', 'info');
            }, 2000);
        }

        function processPayment() {
            // Simulate payment processing
            showNotification('Processing payment...', 'info');
            
            setTimeout(() => {
                const orderId = 'ORD' + Date.now();
                cart = [];
                updateCartDisplay();
                
                showNotification(`Payment successful! Order ID: ${orderId}`, 'success');
                
                // Show order confirmation
                setTimeout(() => {
                    showNotification('Order confirmation sent to your email', 'info');
                }, 2000);
            }, 3000);
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notifications = document.getElementById('notifications');
            const notification = document.createElement('div');
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500',
                warning: 'bg-yellow-500'
            };
            
            notification.className = `notification ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg`;
            notification.textContent = message;
            
            notifications.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Design Editor functionality
        let canvas, ctx, isDrawing = false, currentTool = 'brush';
        let lastX = 0, lastY = 0;

        function setupDesignEditorListeners() {
            const closeEditorBtn = document.getElementById('closeEditorBtn');
            const brushTool = document.getElementById('brushTool');
            const eraserTool = document.getElementById('eraserTool');
            const lineTool = document.getElementById('lineTool');
            const shapeTool = document.getElementById('shapeTool');
            const brushSize = document.getElementById('brushSize');
            const brushSizeValue = document.getElementById('brushSizeValue');
            const brushColor = document.getElementById('brushColor');
            const clearCanvas = document.getElementById('clearCanvas');
            const saveDesign = document.getElementById('saveDesign');

            closeEditorBtn.addEventListener('click', () => {
                document.getElementById('designEditorModal').classList.add('hidden');
            });

            // Tool selection
            [brushTool, eraserTool, lineTool, shapeTool].forEach(tool => {
                tool.addEventListener('click', () => {
                    document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
                    tool.classList.add('active');
                    currentTool = tool.id.replace('Tool', '');
                    updateCanvasCursor();
                });
            });

            // Brush settings
            brushSize.addEventListener('input', (e) => {
                brushSizeValue.textContent = e.target.value + 'px';
            });

            // Garment selection
            document.querySelectorAll('.garment-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.garment-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    updateGarmentPreview(btn.dataset.garment);
                });
            });

            // Design controls
            document.getElementById('designSize').addEventListener('input', (e) => {
                document.getElementById('designSizeValue').textContent = e.target.value + '%';
                updateDesignPreview();
            });

            document.getElementById('designX').addEventListener('input', updateDesignPreview);
            document.getElementById('designY').addEventListener('input', updateDesignPreview);

            clearCanvas.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear the canvas?')) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    updateDesignPreview();
                }
            });

            saveDesign.addEventListener('click', saveCurrentDesign);
        }

        function initializeDrawingCanvas() {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');
            
            // Set canvas size
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = Math.min(600, rect.width - 40);
            canvas.height = 400;
            
            // Set initial drawing settings
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events for mobile
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
            
            updateCanvasCursor();
            updateGarmentPreview('tshirt');
        }

        function startDrawing(e) {
            isDrawing = true;
            [lastX, lastY] = getMousePos(e);
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const [currentX, currentY] = getMousePos(e);
            
            ctx.globalCompositeOperation = currentTool === 'eraser' ? 'destination-out' : 'source-over';
            ctx.strokeStyle = currentTool === 'eraser' ? 'rgba(0,0,0,1)' : document.getElementById('brushColor').value;
            ctx.lineWidth = document.getElementById('brushSize').value;
            
            if (currentTool === 'brush' || currentTool === 'eraser') {
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(currentX, currentY);
                ctx.stroke();
            } else if (currentTool === 'line') {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(currentX, currentY);
                ctx.stroke();
            }
            
            [lastX, lastY] = [currentX, currentY];
            updateDesignPreview();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            return [
                e.clientX - rect.left,
                e.clientY - rect.top
            ];
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 'mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function updateCanvasCursor() {
            const cursors = {
                brush: 'crosshair',
                eraser: 'grab',
                line: 'crosshair',
                shape: 'crosshair'
            };
            canvas.style.cursor = cursors[currentTool] || 'crosshair';
        }

        function updateGarmentPreview(garmentType) {
            const garmentDisplay = document.getElementById('garmentDisplay');
            const garments = {
                tshirt: `
                    <svg width="200" height="240" viewBox="0 0 200 240" class="garment-svg">
                        <path d="M50 60 L50 40 Q50 30 60 30 L140 30 Q150 30 150 40 L150 60 L170 80 L170 220 Q170 230 160 230 L40 230 Q30 230 30 220 L30 80 Z" 
                              fill="#f0f0f0" stroke="#ddd" stroke-width="2"/>
                        <rect id="designArea" x="70" y="80" width="60" height="60" fill="transparent" stroke="#ccc" stroke-dasharray="2,2"/>
                    </svg>
                `,
                hoodie: `
                    <svg width="200" height="260" viewBox="0 0 200 260" class="garment-svg">
                        <path d="M40 70 Q40 60 50 60 L60 50 Q60 40 70 40 L130 40 Q140 40 140 50 L150 60 Q160 60 160 70 L180 90 L180 240 Q180 250 170 250 L30 250 Q20 250 20 240 L20 90 Z" 
                              fill="#f0f0f0" stroke="#ddd" stroke-width="2"/>
                        <circle cx="100" cy="50" r="15" fill="#f0f0f0" stroke="#ddd" stroke-width="2"/>
                        <rect id="designArea" x="70" y="100" width="60" height="60" fill="transparent" stroke="#ccc" stroke-dasharray="2,2"/>
                    </svg>
                `,
                cap: `
                    <svg width="200" height="160" viewBox="0 0 200 160" class="garment-svg">
                        <ellipse cx="100" cy="80" rx="80" ry="60" fill="#f0f0f0" stroke="#ddd" stroke-width="2"/>
                        <path d="M20 80 Q20 70 30 70 L170 70 Q180 70 180 80" fill="#f0f0f0" stroke="#ddd" stroke-width="2"/>
                        <rect id="designArea" x="70" y="60" width="60" height="40" fill="transparent" stroke="#ccc" stroke-dasharray="2,2"/>
                    </svg>
                `,
                bag: `
                    <svg width="200" height="220" viewBox="0 0 200 220" class="garment-svg">
                        <rect x="40" y="60" width="120" height="140" rx="10" fill="#f0f0f0" stroke="#ddd" stroke-width="2"/>
                        <path d="M60 60 L60 40 Q60 30 70 30 L130 30 Q140 30 140 40 L140 60" fill="none" stroke="#ddd" stroke-width="2"/>
                        <rect id="designArea" x="70" y="100" width="60" height="60" fill="transparent" stroke="#ccc" stroke-dasharray="2,2"/>
                    </svg>
                `
            };
            
            garmentDisplay.innerHTML = garments[garmentType] || garments.tshirt;
            updateDesignPreview();
        }

        function updateDesignPreview() {
            const designArea = document.getElementById('designArea');
            if (!designArea || !canvas) return;
            
            const size = document.getElementById('designSize').value / 100;
            const x = document.getElementById('designX').value;
            const y = document.getElementById('designY').value;
            
            // Create a data URL from the canvas
            const dataURL = canvas.toDataURL();
            
            // Remove existing design preview
            const existingPreview = designArea.parentElement.querySelector('.design-preview');
            if (existingPreview) {
                existingPreview.remove();
            }
            
            // Add new design preview
            if (dataURL !== 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==') {
                const preview = document.createElementNS('http://www.w3.org/2000/svg', 'image');
                preview.setAttribute('class', 'design-preview');
                preview.setAttribute('href', dataURL);
                preview.setAttribute('x', 70 + x);
                preview.setAttribute('y', 80 + y);
                preview.setAttribute('width', 60 * size);
                preview.setAttribute('height', 60 * size);
                designArea.parentElement.appendChild(preview);
            }
        }

        function saveCurrentDesign() {
            if (!canvas) return;
            
            const dataURL = canvas.toDataURL();
            const designName = prompt('Enter a name for your design:') || 'Custom Design';
            
            const newDesign = {
                id: Date.now(),
                name: designName,
                src: dataURL,
                category: 'custom',
                description: `Hand-drawn custom design: ${designName}`,
                price: "$35-65",
                time: "30-45 minutes",
                rating: 0,
                reviews: 0,
                isUploaded: true
            };
            
            uploadedImages.push(newDesign);
            document.getElementById('designEditorModal').classList.add('hidden');
            renderGallery();
            showNotification('Design saved successfully!', 'success');
        }

        // AI Generator functionality with real image generation like Gemini AI
        function setupAIGeneratorListeners() {
            const closeAiGeneratorBtn = document.getElementById('closeAiGeneratorBtn');
            const generateDesignBtn = document.getElementById('generateDesignBtn');

            closeAiGeneratorBtn.addEventListener('click', () => {
                document.getElementById('aiGeneratorModal').classList.add('hidden');
            });

            generateDesignBtn.addEventListener('click', generateAIDesign);

            // Setup color customization listeners
            setupColorCustomizationListeners();
        }

        function generateAIDesign() {
            const prompt = document.getElementById('aiPrompt').value;
            const style = document.getElementById('aiStyle').value;
            const colors = document.getElementById('aiColors').value;
            
            if (!prompt.trim()) {
                showNotification('Please describe your design first!', 'error');
                return;
            }
            
            const resultsDiv = document.getElementById('aiGeneratedResults');
            const gridDiv = document.getElementById('aiDesignGrid');
            
            resultsDiv.classList.remove('hidden');
            gridDiv.innerHTML = `
                <div class="col-span-2 text-center py-8">
                    <div class="animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-2"></div>
                    <p class="text-gray-600">🎨 AI is creating your embroidery designs...</p>
                    <p class="text-sm text-gray-500 mt-1">Analyzing: "${prompt}"</p>
                </div>
            `;
            
            // Simulate realistic AI generation with multiple steps
            setTimeout(() => {
                gridDiv.innerHTML = `
                    <div class="col-span-2 text-center py-8">
                        <div class="animate-pulse">
                            <div class="w-16 h-16 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full mx-auto mb-3 flex items-center justify-center">
                                <span class="text-2xl">🧠</span>
                            </div>
                        </div>
                        <p class="text-gray-600">Processing design elements...</p>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-3">
                            <div class="bg-blue-600 h-2 rounded-full animate-pulse" style="width: 60%"></div>
                        </div>
                    </div>
                `;
            }, 1000);

            setTimeout(() => {
                const generatedDesigns = createRealisticAIDesigns(prompt, style, colors);
                
                gridDiv.innerHTML = generatedDesigns.map((design, index) => `
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden cursor-pointer hover:shadow-xl transition-all transform hover:scale-105" onclick="selectAIDesign(${design.id})">
                        <div class="h-40 bg-white flex items-center justify-center overflow-hidden border-b">
                            ${design.svgImage}
                        </div>
                        <div class="p-3">
                            <h5 class="font-semibold text-sm mb-1">${design.name}</h5>
                            <p class="text-xs text-gray-600 mb-2">${design.description.substring(0, 60)}...</p>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-xs font-bold text-green-600">${design.price}</span>
                                <div class="flex items-center text-xs text-yellow-500">
                                    <span>⭐</span>
                                    <span class="ml-1">AI Generated</span>
                                </div>
                            </div>
                            <button class="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white px-2 py-2 rounded text-xs hover:from-blue-600 hover:to-purple-600 transition-all">
                                ✨ Customize & Use
                            </button>
                        </div>
                    </div>
                `).join('');
                
                // Store generated designs
                generatedDesigns.forEach(design => uploadedImages.push(design));
                
                // Show customization panel for first design
                setTimeout(() => {
                    showDesignCustomization(generatedDesigns[0]);
                }, 500);
                
                showNotification('🎨 AI generated amazing designs for you!', 'success');
                
            }, 4000);
        }

        function createRealisticAIDesigns(prompt, style, colors) {
            const lowerPrompt = prompt.toLowerCase();
            const designs = [];
            
            // Generate 4 different variations
            for (let i = 0; i < 4; i++) {
                const design = {
                    id: Date.now() + i,
                    name: `AI ${style} Design ${i + 1}`,
                    category: 'ai-generated',
                    description: `AI-generated ${style} embroidery with ${colors} colors based on: "${prompt}"`,
                    price: "$35-65",
                    time: "20-35 minutes",
                    svgImage: generateRealisticEmbroideryDesign(prompt, style, colors, i),
                    gradient: getAIDesignGradient(colors, i % 2 === 1),
                    rating: 4.7 + (Math.random() * 0.3),
                    reviews: Math.floor(Math.random() * 50) + 10,
                    isAI: true,
                    isRealEmbroidery: true,
                    keywords: extractDesignKeywords(prompt),
                    customizable: true,
                    originalPrompt: prompt,
                    aiStyle: style,
                    aiColors: colors
                };
                designs.push(design);
            }
            
            return designs;
        }

        function generateRealisticEmbroideryDesign(prompt, style, colors, variation) {
            const lowerPrompt = prompt.toLowerCase();
            
            // Color schemes based on AI colors selection
            const colorSchemes = {
                colorful: ['#ff6b9d', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b'],
                pastel: ['#ffeaa7', '#fab1a0', '#fd79a8', '#a29bfe', '#6c5ce7', '#74b9ff'],
                monochrome: ['#2d3436', '#636e72', '#b2bec3', '#ddd', '#000', '#555'],
                bright: ['#ff3838', '#ff9500', '#ffdd00', '#00d4aa', '#0099ff', '#8b00ff'],
                earth: ['#8b4513', '#d2691e', '#daa520', '#228b22', '#2e8b57', '#cd853f']
            };
            
            const currentColors = colorSchemes[colors] || colorSchemes.colorful;
            
            if (lowerPrompt.includes('floral') || lowerPrompt.includes('flower') || lowerPrompt.includes('rose')) {
                return generateFloralEmbroidery(currentColors, variation);
            } else if (lowerPrompt.includes('butterfly') || lowerPrompt.includes('animal')) {
                return generateButterflyEmbroidery(currentColors, variation);
            } else if (lowerPrompt.includes('geometric') || lowerPrompt.includes('mandala')) {
                return generateGeometricEmbroidery(currentColors, variation);
            } else if (lowerPrompt.includes('traditional') || lowerPrompt.includes('ethnic')) {
                return generateTraditionalEmbroidery(currentColors, variation);
            } else if (lowerPrompt.includes('modern') || lowerPrompt.includes('abstract')) {
                return generateModernEmbroidery(currentColors, variation);
            } else {
                return generateCustomEmbroidery(currentColors, variation, prompt);
            }
        }

        function generateFloralEmbroidery(colors, variation) {
            const variations = [
                // Rose design
                `<svg width="120" height="120" viewBox="0 0 120 120">
                    <defs>
                        <radialGradient id="rose${variation}" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" style="stop-color:${colors[0]};stop-opacity:1" />
                            <stop offset="100%" style="stop-color:${colors[1]};stop-opacity:0.8" />
                        </radialGradient>
                    </defs>
                    <circle cx="60" cy="60" r="25" fill="url(#rose${variation})" stroke="${colors[2]}" stroke-width="2"/>
                    <path d="M35 60 Q45 40 60 60 Q75 40 85 60" fill="${colors[3]}" stroke="${colors[4]}" stroke-width="1"/>
                    <path d="M40 70 Q60 80 80 70" stroke="${colors[5]}" stroke-width="2" fill="none"/>
                    <circle cx="55" cy="55" r="3" fill="${colors[4]}"/>
                    <circle cx="65" cy="65" r="2" fill="${colors[0]}"/>
                    <path d="M45 80 L50 90 M70 90 L75 80" stroke="${colors[5]}" stroke-width="2"/>
                </svg>`,
                
                // Lotus design
                `<svg width="120" height="120" viewBox="0 0 120 120">
                    <g transform="rotate(${variation * 15} 60 60)">
                        <ellipse cx="60" cy="40" rx="8" ry="20" fill="${colors[0]}" stroke="${colors[1]}" stroke-width="1"/>
                        <ellipse cx="60" cy="40" rx="8" ry="20" fill="${colors[2]}" stroke="${colors[3]}" stroke-width="1" transform="rotate(45 60 60)"/>
                        <ellipse cx="60" cy="40" rx="8" ry="20" fill="${colors[4]}" stroke="${colors[5]}" stroke-width="1" transform="rotate(90 60 60)"/>
                        <ellipse cx="60" cy="40" rx="8" ry="20" fill="${colors[0]}" stroke="${colors[1]}" stroke-width="1" transform="rotate(135 60 60)"/>
                        <circle cx="60" cy="60" r="8" fill="${colors[3]}" stroke="${colors[4]}" stroke-width="2"/>
                    </g>
                </svg>`,
                
                // Sunflower design
                `<svg width="120" height="120" viewBox="0 0 120 120">
                    <circle cx="60" cy="60" r="15" fill="${colors[4]}" stroke="${colors[5]}" stroke-width="2"/>
                    ${Array.from({length: 12}, (_, i) => {
                        const angle = (i * 30) * Math.PI / 180;
                        const x1 = 60 + Math.cos(angle) * 20;
                        const y1 = 60 + Math.sin(angle) * 20;
                        const x2 = 60 + Math.cos(angle) * 35;
                        const y2 = 60 + Math.sin(angle) * 35;
                        return `<ellipse cx="${x2}" cy="${y2}" rx="4" ry="12" fill="${colors[i % 3]}" transform="rotate(${i * 30} ${x2} ${y2})"/>`;
                    }).join('')}
                    <circle cx="60" cy="60" r="8" fill="${colors[3]}"/>
                </svg>`,
                
                // Cherry blossom
                `<svg width="120" height="120" viewBox="0 0 120 120">
                    <g transform="translate(60, 60)">
                        ${Array.from({length: 5}, (_, i) => {
                            const angle = (i * 72) * Math.PI / 180;
                            const x = Math.cos(angle) * 20;
                            const y = Math.sin(angle) * 20;
                            return `<ellipse cx="${x}" cy="${y}" rx="6" ry="12" fill="${colors[i % colors.length]}" stroke="${colors[(i+1) % colors.length]}" stroke-width="1" transform="rotate(${i * 72} ${x} ${y})"/>`;
                        }).join('')}
                        <circle cx="0" cy="0" r="5" fill="${colors[2]}"/>
                    </g>
                </svg>`
            ];
            
            return variations[variation % variations.length];
        }

        function generateButterflyEmbroidery(colors, variation) {
            return `<svg width="120" height="120" viewBox="0 0 120 120">
                <ellipse cx="45" cy="45" rx="15" ry="12" fill="${colors[0]}" stroke="${colors[1]}" stroke-width="1"/>
                <ellipse cx="45" cy="65" rx="12" ry="10" fill="${colors[2]}" stroke="${colors[3]}" stroke-width="1"/>
                <ellipse cx="75" cy="45" rx="15" ry="12" fill="${colors[0]}" stroke="${colors[1]}" stroke-width="1"/>
                <ellipse cx="75" cy="65" rx="12" ry="10" fill="${colors[2]}" stroke="${colors[3]}" stroke-width="1"/>
                <path d="M60 35 L60 75" stroke="${colors[4]}" stroke-width="3"/>
                <circle cx="60" cy="32" r="3" fill="${colors[5]}"/>
                <path d="M58 28 Q60 25 62 28" stroke="${colors[4]}" stroke-width="2" fill="none"/>
                <circle cx="42" cy="42" r="2" fill="${colors[4]}"/>
                <circle cx="78" cy="42" r="2" fill="${colors[4]}"/>
                <path d="M35 50 Q30 55 35 60" stroke="${colors[5]}" stroke-width="1" fill="none"/>
                <path d="M85 50 Q90 55 85 60" stroke="${colors[5]}" stroke-width="1" fill="none"/>
            </svg>`;
        }

        function generateGeometricEmbroidery(colors, variation) {
            return `<svg width="120" height="120" viewBox="0 0 120 120">
                <circle cx="60" cy="60" r="30" fill="none" stroke="${colors[0]}" stroke-width="2"/>
                <circle cx="60" cy="60" r="20" fill="none" stroke="${colors[1]}" stroke-width="1"/>
                <circle cx="60" cy="60" r="10" fill="${colors[2]}"/>
                ${Array.from({length: 8}, (_, i) => {
                    const angle = (i * 45) * Math.PI / 180;
                    const x1 = 60 + Math.cos(angle) * 15;
                    const y1 = 60 + Math.sin(angle) * 15;
                    const x2 = 60 + Math.cos(angle) * 25;
                    const y2 = 60 + Math.sin(angle) * 25;
                    return `<path d="M${x1} ${y1} L${x2} ${y2}" stroke="${colors[(i + 2) % colors.length]}" stroke-width="2"/>`;
                }).join('')}
                ${Array.from({length: 6}, (_, i) => {
                    const angle = (i * 60) * Math.PI / 180;
                    const x = 60 + Math.cos(angle) * 35;
                    const y = 60 + Math.sin(angle) * 35;
                    return `<circle cx="${x}" cy="${y}" r="3" fill="${colors[(i + 3) % colors.length]}"/>`;
                }).join('')}
            </svg>`;
        }

        function generateTraditionalEmbroidery(colors, variation) {
            return `<svg width="120" height="120" viewBox="0 0 120 120">
                <path d="M40 30 Q70 20 80 50 Q75 80 50 85 Q30 75 35 50 Q38 35 40 30" 
                      fill="${colors[0]}" stroke="${colors[1]}" stroke-width="2"/>
                <circle cx="55" cy="45" r="4" fill="${colors[2]}" stroke="${colors[3]}"/>
                <circle cx="60" cy="60" r="3" fill="${colors[4]}" stroke="${colors[5]}"/>
                <path d="M45 55 Q55 50 60 60" stroke="${colors[2]}" stroke-width="2" fill="none"/>
                <circle cx="50" cy="70" r="2" fill="${colors[3]}"/>
                <path d="M30 40 Q40 35 45 45" stroke="${colors[4]}" stroke-width="1" fill="none"/>
                <path d="M70 40 Q80 35 85 45" stroke="${colors[5]}" stroke-width="1" fill="none"/>
            </svg>`;
        }

        function generateModernEmbroidery(colors, variation) {
            return `<svg width="120" height="120" viewBox="0 0 120 120">
                <rect x="30" y="30" width="60" height="60" rx="10" fill="${colors[0]}" stroke="${colors[1]}" stroke-width="2"/>
                <circle cx="45" cy="45" r="8" fill="${colors[2]}"/>
                <circle cx="75" cy="45" r="8" fill="${colors[3]}"/>
                <rect x="50" y="65" width="20" height="15" rx="3" fill="${colors[4]}"/>
                <path d="M40 75 Q60 85 80 75" stroke="${colors[5]}" stroke-width="3" fill="none"/>
            </svg>`;
        }

        function generateCustomEmbroidery(colors, variation, prompt) {
            // Generate based on prompt keywords
            return `<svg width="120" height="120" viewBox="0 0 120 120">
                <circle cx="60" cy="60" r="25" fill="${colors[0]}" stroke="${colors[1]}" stroke-width="2" opacity="0.8"/>
                <path d="M35 60 Q60 35 85 60 Q60 85 35 60" fill="${colors[2]}" stroke="${colors[3]}" stroke-width="1"/>
                <circle cx="60" cy="60" r="10" fill="${colors[4]}"/>
                <text x="60" y="100" text-anchor="middle" font-size="8" fill="${colors[5]}" font-weight="bold">CUSTOM</text>
            </svg>`;
        }

        function extractDesignKeywords(prompt) {
            const words = prompt.toLowerCase().split(' ');
            const keywords = [];
            
            const keywordMap = {
                'floral': ['flower', 'rose', 'lotus', 'petal', 'bloom'],
                'traditional': ['ethnic', 'indian', 'cultural', 'heritage'],
                'modern': ['contemporary', 'abstract', 'minimalist'],
                'colorful': ['bright', 'vibrant', 'rainbow'],
                'elegant': ['sophisticated', 'classy', 'refined'],
                'cute': ['adorable', 'sweet', 'lovely']
            };
            
            Object.keys(keywordMap).forEach(key => {
                if (words.some(word => keywordMap[key].includes(word) || word.includes(key))) {
                    keywords.push(key);
                }
            });
            
            return keywords.length > 0 ? keywords : ['custom', 'ai-generated'];
        }

        function showDesignCustomization(design) {
            const customizationPanel = document.getElementById('designCustomization');
            customizationPanel.classList.remove('hidden');
            customizationPanel.currentDesign = design;
            
            // Setup color change listeners
            setupColorCustomizationListeners();
        }

        function setupColorCustomizationListeners() {
            const colorOptions = document.querySelectorAll('.color-option');
            const bgStyleBtns = document.querySelectorAll('.bg-style-btn');
            const applyCustomization = document.getElementById('applyCustomization');
            
            colorOptions.forEach(btn => {
                btn.addEventListener('click', () => {
                    colorOptions.forEach(b => b.classList.remove('ring-4', 'ring-blue-500'));
                    btn.classList.add('ring-4', 'ring-blue-500');
                });
            });
            
            bgStyleBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    bgStyleBtns.forEach(b => b.classList.remove('bg-blue-500', 'text-white'));
                    btn.classList.add('bg-blue-500', 'text-white');
                });
            });
            
            if (applyCustomization) {
                applyCustomization.onclick = () => {
                    const customizationPanel = document.getElementById('designCustomization');
                    const design = customizationPanel.currentDesign;
                    
                    if (design) {
                        // Apply customizations
                        const selectedColor = document.querySelector('.color-option.ring-4')?.dataset.color || 'blue';
                        const selectedSize = document.getElementById('designSizeSelect').value;
                        const selectedStyle = document.querySelector('.bg-style-btn.bg-blue-500')?.dataset.style || 'solid';
                        
                        // Update design with customizations
                        design.customizations = {
                            color: selectedColor,
                            size: selectedSize,
                            style: selectedStyle
                        };
                        
                        design.name += ` (${selectedColor} ${selectedSize})`;
                        
                        showNotification(`Design customized with ${selectedColor} color and ${selectedSize} size!`, 'success');
                        
                        // Add to gallery
                        renderGallery();
                    }
                };
            }
        }

        function getAIDesignEmoji(prompt, style, variant = false) {
            const lowerPrompt = prompt.toLowerCase();
            
            if (lowerPrompt.includes('floral') || lowerPrompt.includes('flower')) {
                return variant ? '🌺' : '🌸';
            } else if (lowerPrompt.includes('animal')) {
                return variant ? '🦋' : '🐾';
            } else if (lowerPrompt.includes('geometric')) {
                return variant ? '🔷' : '🔶';
            } else if (lowerPrompt.includes('star')) {
                return variant ? '⭐' : '✨';
            } else if (lowerPrompt.includes('heart')) {
                return variant ? '💖' : '💝';
            } else {
                return variant ? '🎨' : '✨';
            }
        }

        function getAIDesignGradient(colors, variant = false) {
            const gradients = {
                colorful: variant ? 'from-pink-200 to-purple-300' : 'from-blue-200 to-green-300',
                pastel: variant ? 'from-rose-200 to-pink-200' : 'from-blue-100 to-purple-200',
                monochrome: variant ? 'from-gray-300 to-gray-400' : 'from-gray-200 to-gray-300',
                bright: variant ? 'from-yellow-300 to-orange-400' : 'from-red-300 to-pink-400',
                earth: variant ? 'from-amber-200 to-orange-300' : 'from-green-200 to-yellow-300'
            };
            
            return gradients[colors] || gradients.colorful;
        }

        window.selectAIDesign = function(designId) {
            const design = uploadedImages.find(d => d.id === designId);
            if (design) {
                document.getElementById('aiGeneratorModal').classList.add('hidden');
                renderGallery();
                showNotification(`${design.name} added to your gallery!`, 'success');
                
                // Scroll to gallery and highlight the new design
                setTimeout(() => {
                    document.getElementById('gallery').scrollIntoView({ behavior: 'smooth' });
                }, 500);
            }
        };

        // Smart Search functionality
        function handleSmartSearch(query) {
            const smartResults = document.getElementById('smartSearchResults');
            
            if (query.length < 3) {
                smartResults.classList.add('hidden');
                renderGallery(query);
                return;
            }

            // Check if query contains size measurements
            const sizePattern = /(\d+),(\d+),(\d+)/;
            const sizeMatch = query.match(sizePattern);
            
            // Extract keywords from query
            const keywords = extractKeywords(query);
            const matchingDesigns = findMatchingDesigns(keywords);
            
            if (sizeMatch && matchingDesigns.length > 0) {
                // Show smart search results with body visualization option
                showSmartSearchResults(matchingDesigns, sizeMatch, query);
            } else {
                // Regular search
                smartResults.classList.add('hidden');
                renderGallery(query);
            }
        }

        function extractKeywords(query) {
            const lowerQuery = query.toLowerCase();
            const keywords = [];
            
            // Common embroidery keywords
            const embroideryKeywords = [
                'mirror work', 'floral', 'traditional', 'ethnic', 'anarkali', 'lehenga', 
                'saree', 'kurta', 'tshirt', 't-shirt', 'dupatta', 'rose', 'butterfly',
                'mandala', 'paisley', 'corporate', 'sports', 'girl', 'woman', 'wedding'
            ];
            
            embroideryKeywords.forEach(keyword => {
                if (lowerQuery.includes(keyword)) {
                    keywords.push(keyword);
                }
            });
            
            return keywords;
        }

        function findMatchingDesigns(keywords) {
            let allImages = [...sampleDesigns, ...uploadedImages];
            
            return allImages.filter(design => {
                if (!design.keywords) return false;
                
                return keywords.some(keyword => 
                    design.keywords.some(designKeyword => 
                        designKeyword.toLowerCase().includes(keyword.toLowerCase()) ||
                        keyword.toLowerCase().includes(designKeyword.toLowerCase())
                    )
                );
            });
        }

        function showSmartSearchResults(designs, sizeMatch, originalQuery) {
            const smartResults = document.getElementById('smartSearchResults');
            const [, bust, waist, hip] = sizeMatch;
            
            smartResults.innerHTML = `
                <div class="p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-semibold text-gray-800">Smart Search Results</h4>
                        <span class="text-sm text-gray-500">${designs.length} matches found</span>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg mb-4">
                        <p class="text-sm text-blue-800">
                            <strong>Detected:</strong> Size ${bust}-${waist}-${hip} | Keywords: ${extractKeywords(originalQuery).join(', ')}
                        </p>
                    </div>
                    <div class="space-y-2">
                        ${designs.slice(0, 3).map(design => `
                            <div class="flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg cursor-pointer" onclick="showBodyVisualization(${design.id}, '${bust}', '${waist}', '${hip}')">
                                <div class="w-12 h-12 bg-gradient-to-br ${design.gradient} rounded-lg flex items-center justify-center">
                                    ${design.isUploaded ? 
                                        `<img src="${design.src}" class="w-full h-full object-cover rounded-lg">` :
                                        `<span class="text-lg">${design.image}</span>`
                                    }
                                </div>
                                <div class="flex-1">
                                    <h5 class="font-medium text-gray-800">${design.name}</h5>
                                    <p class="text-sm text-gray-600">${design.price} • ${design.time}</p>
                                </div>
                                <button class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">
                                    👗 Visualize
                                </button>
                            </div>
                        `).join('')}
                    </div>
                    ${designs.length > 3 ? `
                        <button onclick="showAllResults('${originalQuery}')" class="w-full mt-3 text-blue-600 hover:text-blue-700 text-sm font-medium">
                            View all ${designs.length} results →
                        </button>
                    ` : ''}
                </div>
            `;
            
            smartResults.classList.remove('hidden');
        }

        function showBodyVisualization(designId, bust, waist, hip) {
            const design = [...sampleDesigns, ...uploadedImages].find(d => d.id === designId);
            if (!design) return;
            
            const modal = document.getElementById('bodyVisualizationModal');
            const bodyViz = document.getElementById('bodyVisualization');
            const measurementInfo = document.getElementById('measurementInfo');
            const designDetails = document.getElementById('visualizationDesignDetails');
            
            // Generate body visualization based on measurements
            const bodyType = determineBodyType(bust, waist, hip);
            bodyViz.innerHTML = generateBodyVisualization(bodyType, design, bust, waist, hip);
            
            measurementInfo.innerHTML = `
                <div class="bg-blue-50 p-3 rounded-lg">
                    <h5 class="font-semibold text-blue-800 mb-2">Your Measurements</h5>
                    <div class="grid grid-cols-3 gap-4 text-sm">
                        <div class="text-center">
                            <p class="font-medium">Bust</p>
                            <p class="text-blue-600">${bust}"</p>
                        </div>
                        <div class="text-center">
                            <p class="font-medium">Waist</p>
                            <p class="text-blue-600">${waist}"</p>
                        </div>
                        <div class="text-center">
                            <p class="font-medium">Hip</p>
                            <p class="text-blue-600">${hip}"</p>
                        </div>
                    </div>
                    <p class="text-xs text-blue-600 mt-2">Body Type: ${bodyType}</p>
                </div>
            `;
            
            designDetails.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <h5 class="font-semibold text-gray-700">${design.name}</h5>
                        <p class="text-gray-600 text-sm">${design.description}</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm text-gray-500">Price Range</p>
                            <p class="font-semibold text-green-600">${design.price}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Time Required</p>
                            <p class="font-semibold">${design.time}</p>
                        </div>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Suitable for</p>
                        <div class="flex flex-wrap gap-2 mt-1">
                            ${design.garmentTypes ? design.garmentTypes.map(type => 
                                `<span class="px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs capitalize">${type}</span>`
                            ).join('') : ''}
                        </div>
                    </div>
                    <div class="bg-green-50 p-3 rounded-lg">
                        <p class="text-sm text-green-800">
                            <strong>Perfect Fit:</strong> This design will look great on your ${bodyType} body type!
                        </p>
                    </div>
                </div>
            `;
            
            // Store current design for cart actions
            modal.currentDesign = design;
            modal.currentMeasurements = { bust, waist, hip };
            
            document.getElementById('smartSearchResults').classList.add('hidden');
            modal.classList.remove('hidden');
        }

        function determineBodyType(bust, waist, hip) {
            const bustNum = parseInt(bust);
            const waistNum = parseInt(waist);
            const hipNum = parseInt(hip);
            
            if (Math.abs(bustNum - hipNum) <= 2 && waistNum < bustNum - 4) {
                return "Hourglass";
            } else if (bustNum > hipNum + 2) {
                return "Apple";
            } else if (hipNum > bustNum + 2) {
                return "Pear";
            } else {
                return "Rectangle";
            }
        }

        function generateBodyVisualization(bodyType, design, bust, waist, hip) {
            const bodyShapes = {
                "Hourglass": `
                    <svg width="200" height="300" viewBox="0 0 200 300" class="mx-auto">
                        <!-- Hourglass body shape -->
                        <path d="M70 50 Q100 40 130 50 L140 120 Q100 110 60 120 Z" fill="#f0d0b0" stroke="#d4a574" stroke-width="2"/>
                        <path d="M60 120 Q100 130 140 120 L130 250 Q100 260 70 250 Z" fill="#f0d0b0" stroke="#d4a574" stroke-width="2"/>
                        <!-- Design placement -->
                        <g transform="translate(85, 140)">
                            ${generateDesignOnBody(design)}
                        </g>
                        <!-- Measurements -->
                        <text x="150" y="80" class="text-xs fill-blue-600">${bust}"</text>
                        <text x="150" y="130" class="text-xs fill-blue-600">${waist}"</text>
                        <text x="150" y="200" class="text-xs fill-blue-600">${hip}"</text>
                    </svg>
                `,
                "Apple": `
                    <svg width="200" height="300" viewBox="0 0 200 300" class="mx-auto">
                        <path d="M60 50 Q100 40 140 50 L145 180 Q100 190 55 180 Z" fill="#f0d0b0" stroke="#d4a574" stroke-width="2"/>
                        <path d="M55 180 Q100 185 145 180 L130 250 Q100 260 70 250 Z" fill="#f0d0b0" stroke="#d4a574" stroke-width="2"/>
                        <g transform="translate(85, 120)">
                            ${generateDesignOnBody(design)}
                        </g>
                        <text x="150" y="80" class="text-xs fill-blue-600">${bust}"</text>
                        <text x="150" y="130" class="text-xs fill-blue-600">${waist}"</text>
                        <text x="150" y="200" class="text-xs fill-blue-600">${hip}"</text>
                    </svg>
                `,
                "Pear": `
                    <svg width="200" height="300" viewBox="0 0 200 300" class="mx-auto">
                        <path d="M75 50 Q100 45 125 50 L130 120 Q100 115 70 120 Z" fill="#f0d0b0" stroke="#d4a574" stroke-width="2"/>
                        <path d="M70 120 Q100 125 130 120 L145 250 Q100 265 55 250 Z" fill="#f0d0b0" stroke="#d4a574" stroke-width="2"/>
                        <g transform="translate(85, 140)">
                            ${generateDesignOnBody(design)}
                        </g>
                        <text x="135" y="80" class="text-xs fill-blue-600">${bust}"</text>
                        <text x="135" y="130" class="text-xs fill-blue-600">${waist}"</text>
                        <text x="150" y="200" class="text-xs fill-blue-600">${hip}"</text>
                    </svg>
                `,
                "Rectangle": `
                    <svg width="200" height="300" viewBox="0 0 200 300" class="mx-auto">
                        <path d="M75 50 Q100 45 125 50 L125 250 Q100 255 75 250 Z" fill="#f0d0b0" stroke="#d4a574" stroke-width="2"/>
                        <g transform="translate(85, 140)">
                            ${generateDesignOnBody(design)}
                        </g>
                        <text x="135" y="80" class="text-xs fill-blue-600">${bust}"</text>
                        <text x="135" y="130" class="text-xs fill-blue-600">${waist}"</text>
                        <text x="135" y="200" class="text-xs fill-blue-600">${hip}"</text>
                    </svg>
                `
            };
            
            return bodyShapes[bodyType] || bodyShapes["Rectangle"];
        }

        function generateDesignOnBody(design) {
            if (design.isUploaded) {
                return `<image href="${design.src}" x="-15" y="-15" width="30" height="30" opacity="0.8"/>`;
            } else {
                return `<text x="0" y="0" text-anchor="middle" class="text-lg">${design.image}</text>`;
            }
        }

        // Admin Panel functionality
        function setupAdminListeners() {
            const adminBtn = document.getElementById('adminBtn');
            const adminModal = document.getElementById('adminModal');
            const closeAdminBtn = document.getElementById('closeAdminBtn');
            const adminAddDesignForm = document.getElementById('adminAddDesignForm');
            const adminDesignImage = document.getElementById('adminDesignImage');

            adminBtn.addEventListener('click', () => {
                adminModal.classList.remove('hidden');
                loadAdminData();
            });

            closeAdminBtn.addEventListener('click', () => {
                adminModal.classList.add('hidden');
            });

            // Admin tab switching
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // Update active tab
                    document.querySelectorAll('.admin-tab-btn').forEach(b => {
                        b.classList.remove('active', 'bg-blue-500', 'text-white');
                        b.classList.add('hover:bg-gray-200');
                    });
                    btn.classList.add('active', 'bg-blue-500', 'text-white');
                    btn.classList.remove('hover:bg-gray-200');

                    // Show corresponding content
                    document.querySelectorAll('.admin-content').forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    const contentId = btn.id.replace('Tab', 'Content');
                    document.getElementById(contentId).classList.remove('hidden');
                });
            });

            // Image preview
            adminDesignImage.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById('adminImagePreview').classList.remove('hidden');
                        document.getElementById('adminPreviewImg').src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Form submission
            adminAddDesignForm.addEventListener('submit', (e) => {
                e.preventDefault();
                addNewDesignFromAdmin();
            });

            // Body visualization modal
            const closeBodyVisualizationBtn = document.getElementById('closeBodyVisualizationBtn');
            const addVisualizationToCart = document.getElementById('addVisualizationToCart');
            const customizeDesign = document.getElementById('customizeDesign');

            closeBodyVisualizationBtn.addEventListener('click', () => {
                document.getElementById('bodyVisualizationModal').classList.add('hidden');
            });

            addVisualizationToCart.addEventListener('click', () => {
                const modal = document.getElementById('bodyVisualizationModal');
                if (modal.currentDesign) {
                    addToCart(modal.currentDesign);
                    modal.classList.add('hidden');
                }
            });

            customizeDesign.addEventListener('click', () => {
                document.getElementById('bodyVisualizationModal').classList.add('hidden');
                document.getElementById('designEditorModal').classList.remove('hidden');
                initializeDrawingCanvas();
            });
        }

        function loadAdminData() {
            // Load manage designs
            const adminDesignsList = document.getElementById('adminDesignsList');
            const allDesigns = [...sampleDesigns, ...uploadedImages];
            
            adminDesignsList.innerHTML = allDesigns.map(design => `
                <div class="bg-white border rounded-lg p-4">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-gradient-to-br ${design.gradient || 'from-gray-200 to-gray-300'} rounded-lg flex items-center justify-center">
                            ${design.isUploaded ? 
                                `<img src="${design.src}" class="w-full h-full object-cover rounded-lg">` :
                                `<span class="text-2xl">${design.image}</span>`
                            }
                        </div>
                        <div class="flex-1">
                            <h5 class="font-semibold">${design.name}</h5>
                            <p class="text-sm text-gray-600">${design.category} • ${design.price}</p>
                            <p class="text-xs text-gray-500">${design.keywords ? design.keywords.join(', ') : 'No keywords'}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="editDesign(${design.id})" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">Edit</button>
                            <button onclick="deleteDesign(${design.id})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');

            // Load keywords
            const keywordsList = document.getElementById('keywordsList');
            const allKeywords = new Set();
            allDesigns.forEach(design => {
                if (design.keywords) {
                    design.keywords.forEach(keyword => allKeywords.add(keyword));
                }
            });

            keywordsList.innerHTML = Array.from(allKeywords).map(keyword => `
                <div class="flex justify-between items-center p-3 bg-white border rounded-lg">
                    <span class="font-medium">${keyword}</span>
                    <span class="text-sm text-gray-500">${countKeywordUsage(keyword, allDesigns)} designs</span>
                </div>
            `).join('');
        }

        function addNewDesignFromAdmin() {
            const name = document.getElementById('adminDesignName').value;
            const category = document.getElementById('adminDesignCategory').value;
            const description = document.getElementById('adminDesignDescription').value;
            const price = document.getElementById('adminDesignPrice').value;
            const time = document.getElementById('adminDesignTime').value;
            const keywords = document.getElementById('adminSearchKeywords').value.split(',').map(k => k.trim());
            const garmentTypes = Array.from(document.getElementById('adminGarmentTypes').selectedOptions).map(option => option.value);
            const imageFile = document.getElementById('adminDesignImage').files[0];

            if (!name || !imageFile) {
                showNotification('Please fill in required fields and upload an image', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const newDesign = {
                    id: Date.now(),
                    name: name,
                    category: category,
                    description: description,
                    price: price || "$30-60",
                    time: time || "25-40 minutes",
                    src: e.target.result,
                    keywords: keywords,
                    garmentTypes: garmentTypes,
                    rating: 0,
                    reviews: 0,
                    isUploaded: true,
                    isAdmin: true
                };

                uploadedImages.push(newDesign);
                renderGallery();
                loadAdminData();
                
                // Reset form
                document.getElementById('adminAddDesignForm').reset();
                document.getElementById('adminImagePreview').classList.add('hidden');
                
                showNotification('Design added successfully!', 'success');
            };
            reader.readAsDataURL(imageFile);
        }

        function countKeywordUsage(keyword, designs) {
            return designs.filter(design => 
                design.keywords && design.keywords.some(k => 
                    k.toLowerCase().includes(keyword.toLowerCase())
                )
            ).length;
        }

        // Global functions for admin actions
        window.showBodyVisualization = showBodyVisualization;
        window.showAllResults = function(query) {
            document.getElementById('smartSearchResults').classList.add('hidden');
            renderGallery(query);
        };
        window.editDesign = function(designId) {
            showNotification('Edit functionality coming soon!', 'info');
        };
        window.deleteDesign = function(designId) {
            if (confirm('Are you sure you want to delete this design?')) {
                uploadedImages = uploadedImages.filter(design => design.id !== designId);
                renderGallery();
                loadAdminData();
                showNotification('Design deleted successfully', 'success');
            }
        };

        // Make functions globally accessible
        window.updateCartQuantity = updateCartQuantity;
        window.removeFromCart = removeFromCart;

        // Initialize the application
        init();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'989a31ee11333fba',t:'MTc1OTYzODc0NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
